<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/drawing.css">
    <link rel="stylesheet" href="/static/css/rps.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎮</text></svg>">
</head>

<body class="expo-shell">
    <main class="layout">
        <section class="console">
            <div class="console-panel">
                <div class="console-heading">
                    <h3>控制台</h3>
                    <p>選擇展場當前要展示的互動模組。</p>
                </div>
                <div class="console-modes">
                    <button type="button" class="chip mode-btn active" data-mode="emotion">情緒分析</button>
                    <button type="button" class="chip mode-btn" data-mode="action">動作偵測</button>
                    <button type="button" class="chip mode-btn" data-mode="rps">猜拳</button>
                    <button type="button" class="chip mode-btn" data-mode="drawing">畫布</button>
                </div>
            </div>
        </section>

        <section class="interactive">
            <article class="panel analysis-panel" id="emotion-panel">
                <header class="panel-header">
                    <div>
                        <span class="panel-tag">Emotion Studio</span>
                        <h2>情緒分析工作台</h2>
                        <p>一次支援圖片、影片、即時攝影機的多模態偵測。</p>
                    </div>
                    <div class="tabs analysis-tabs">
                        <button class="tab-btn" data-tab="upload">📁 上傳分析</button>
                        <button class="tab-btn active" data-tab="webcam">📹 攝影機分析</button>
                    </div>
                </header>

                <div class="panel-body">
                    <div class="tab-content" id="upload-tab">
                        <form id="emotion-upload-form" method="post" enctype="multipart/form-data" class="upload-form">
                            <div class="dropzone" id="emotion-drop-zone">
                                <div class="dropzone-copy">
                                    <div class="dropzone-icon">📤</div>
                                    <h3>拖放素材或點擊上傳</h3>
                                    <p>支援圖片與影片，單檔上限 {{ max_file_size_mb }} MB。</p>
                                    <button type="button" class="btn secondary"
                                        onclick="document.getElementById('emotion-file-input').click()">挑選檔案</button>
                                </div>
                            </div>

                            <div id="emotion-file-preview" class="file-preview hidden">
                                <div class="file-meta">
                                    <div class="file-lines">
                                        <span class="file-name"></span>
                                        <span class="file-size"></span>
                                        <span class="file-duration"></span>
                                    </div>
                                    <div class="file-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 0%"></div>
                                        </div>
                                        <span class="progress-text">準備中...</span>
                                    </div>
                                </div>
                                <button type="button" class="remove-file" onclick="clearEmotionFileSelection()"
                                    aria-label="移除檔案">✕</button>
                            </div>

                            <div id="emotion-upload-progress" class="upload-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress-fill"></div>
                                </div>
                                <span class="progress-percentage">0%</span>
                            </div>

                            <input id="emotion-file-input" name="file" type="file" accept="image/*,video/*" hidden>

                            <div class="form-group">
                                <button type="submit" class="btn primary" disabled id="emotion-analyze-btn">
                                    <span class="btn-text">開始情緒分析</span>
                                    <span class="btn-spinner" style="display: none;">⏳ 分析中...</span>
                                </button>
                            </div>
                        </form>

                        <div id="emotion-upload-results" class="results hidden">
                            <div class="results-header">
                                <h3>🎭 情緒分析結果</h3>
                            </div>
                            <div id="emotion-upload-content" class="results-content"></div>
                        </div>
                    </div>

                    <div class="tab-content active" id="webcam-tab">
                        <div class="realtime-controls">
                            <div class="control-card">
                                <div class="control-card__header">
                                    <div class="control-card__title">
                                        <span class="control-card__pill">Webcam Mode</span>
                                        <h3>即時情緒檢測</h3>
                                    </div>
                                    <div class="live-indicator" id="emotion-live-indicator">
                                        <span class="live-dot"></span>
                                        <span class="live-label" id="emotion-live-indicator-label">待命</span>
                                    </div>
                                </div>
                                <p class="control-card__copy">使用攝影機即時偵測情緒，分析結果會即時顯示於下方儀表板。</p>
                                <div class="control-buttons control-card__actions">
                                    <button type="button" class="btn primary" id="start-emotion-btn">開始情緒檢測</button>
                                    <button type="button" class="btn ghost" id="stop-emotion-btn" disabled>停止檢測</button>
                                </div>
                            </div>
                        </div>

                        <div class="camera-preview hidden" id="emotion-preview">
                            <div class="preview-header">
                                <h3>📹 即時檢測</h3>
                                <div class="preview-stats">
                                    <span id="detection-duration">00:00</span>
                                    <span class="divider"></span>
                                    <span id="detection-count">0</span> 次檢測
                                </div>
                            </div>
                            <div class="camera-container">
                                <!-- 攝影機畫面會插入這裡 -->
                            </div>
                            <div class="emotion-display">
                                <div class="emotion-icon" id="emotion-icon">🎭</div>
                                <div class="emotion-info">
                                    <div class="emotion-name" id="emotion-name">等待檢測</div>
                                    <div class="emotion-confidence">信心度: <span id="emotion-confidence">0%</span></div>
                                </div>
                            </div>
                            <div class="emotion-trend">
                                <div class="trend-item">
                                    <span class="trend-label">主導情緒</span>
                                    <span id="dominant-emotion">中性</span>
                                </div>
                                <div class="trend-item">
                                    <span class="trend-label">穩定性</span>
                                    <span id="emotion-stability">穩定</span>
                                </div>
                            </div>
                        </div>

                        <div class="emotion-results hidden" id="emotion-results">
                            <h3>📈 檢測統計</h3>
                            <div id="emotion-summary"></div>
                        </div>
                    </div>
                </div>
            </article>

            <article class="panel analysis-panel hidden" id="action-panel">
                <header class="panel-header">
                    <div>
                        <span class="panel-tag">Action Arena</span>
                        <h2>動作偵測挑戰</h2>
                        <p>設定關卡難度，讓觀眾在舞台上完成指定動作。</p>
                    </div>
                    <div class="tabs analysis-tabs">
                        <button class="tab-btn" data-tab="action-upload">📁 影片分析</button>
                        <button class="tab-btn active" data-tab="action-game">🎮 即時遊戲</button>
                    </div>
                </header>

                <div class="panel-body">
                    <div class="tab-content" id="action-upload-tab">
                        <form id="action-upload-form" method="post" enctype="multipart/form-data" class="upload-form">
                            <div class="dropzone" id="action-drop-zone">
                                <div class="dropzone-copy">
                                    <div class="dropzone-icon">📤</div>
                                    <h3>拖放影片或點擊上傳</h3>
                                    <p>支援 MP4, AVI, MOV 等格式，單檔上限 {{ max_file_size_mb }} MB。</p>
                                    <button type="button" class="btn secondary"
                                        onclick="document.getElementById('action-file-input').click()">挑選影片</button>
                                </div>
                            </div>

                            <div id="action-file-preview" class="file-preview hidden">
                                <div class="file-meta">
                                    <div class="file-lines">
                                        <span class="file-name"></span>
                                        <span class="file-size"></span>
                                        <span class="file-duration"></span>
                                    </div>
                                    <div class="file-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 0%"></div>
                                        </div>
                                        <span class="progress-text">準備中...</span>
                                    </div>
                                </div>
                                <button type="button" class="remove-file" onclick="clearActionFileSelection()"
                                    aria-label="移除檔案">✕</button>
                            </div>

                            <input id="action-file-input" name="file" type="file" accept="video/*" hidden>

                            <div class="form-group">
                                <button type="submit" class="btn primary" disabled id="action-analyze-btn">
                                    <span class="btn-text">開始動作分析</span>
                                    <span class="btn-spinner" style="display: none;">⏳ 分析中...</span>
                                </button>
                            </div>
                        </form>

                        <div id="action-upload-results" class="results hidden">
                            <div class="results-header">
                                <h3>🤸 動作分析結果</h3>
                                <p>檢測影片中的各種動作表現。</p>
                            </div>
                            <div id="action-upload-content" class="results-content"></div>
                        </div>
                    </div>

                    <div class="tab-content active" id="action-game-tab">
                        <div class="action-controls">
                            <div class="form-group">
                                <label for="difficulty-select">遊戲難度：</label>
                                <select id="difficulty-select" name="difficulty">
                                    <option value="easy">🟢 簡單 (3個動作)</option>
                                    <option value="medium">🟡 中等 (5個動作)</option>
                                    <option value="hard">🔴 困難 (7個動作)</option>
                                </select>
                            </div>
                            <div class="control-buttons">
                                <button type="button" class="btn primary" id="start-action-btn">開始遊戲</button>
                                <button type="button" class="btn secondary" id="stop-action-btn" disabled>停止遊戲</button>
                            </div>
                        </div>

                        <div class="game-status hidden" id="game-status">
                            <div class="game-header">
                                <h3>🎮 遊戲進行中</h3>
                                <div class="game-stats">
                                    <span>難度: <span id="game-difficulty">簡單</span></span>
                                    <span class="divider"></span>
                                    <span>進度: <span id="game-progress">0/3</span></span>
                                    <span class="divider"></span>
                                    <span>分數: <span id="game-score">0</span></span>
                                </div>
                            </div>
                            <div class="current-action">
                                <div class="action-prompt">
                                    <div class="action-emoji" id="action-emoji">🎯</div>
                                    <div class="action-info">
                                        <div class="action-name" id="action-name">準備開始...</div>
                                        <div class="action-description" id="action-description">遊戲即將開始</div>
                                    </div>
                                </div>
                                <div class="action-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="action-progress-fill"></div>
                                    </div>
                                    <div class="progress-text" id="action-progress-text">0%</div>
                                </div>
                            </div>
                            <div class="action-checklist">
                                <h4>✅ 動作清單</h4>
                                <div id="action-list"></div>
                            </div>
                        </div>

                        <div class="game-results hidden" id="game-results">
                            <h3>🏆 遊戲結果</h3>
                            <div id="final-score-display"></div>
                        </div>
                    </div>
                </div>
            </article>

            <article class="panel analysis-panel hidden" id="rps-panel">
                <header class="panel-header">
                    <div>
                        <span class="panel-tag">RPS Duel Stage</span>
                        <h2>猜拳對戰</h2>
                        <p>用手勢進行剪刀石頭布遊戲，挑戰不同難度的 AI 對手。</p>
                    </div>
                </header>

                <div class="panel-body">
                    <div class="rps-controls">
                        <div class="control-buttons">
                            <button type="button" class="btn primary" id="start-rps-btn">開始遊戲</button>
                        </div>
                    </div>

                    <!-- 攝影機預覽區域（不在 hidden 區域內） -->
                    <div class="rps-camera-section">
                        <div class="rps-camera-container">
                            <video id="rps-video" autoplay muted playsinline></video>
                            <canvas id="rps-canvas" style="display: none;"></canvas>
                        </div>

                        <!-- 動畫顯示框（固定在右邊） -->
                        <div class="rps-display-frame">
                            <!-- 倒數數字 -->
                            <div class="rps-countdown-overlay" id="rps-countdown-overlay" style="display: none;">
                                <div class="countdown-number" id="countdown-number">3</div>
                            </div>

                            <!-- 對戰結果顯示區 -->
                            <div class="rps-battle-display" id="rps-battle-display" style="display: none;">
                                <div class="battle-player">
                                    <div class="battle-label">你的手勢</div>
                                    <img class="battle-gesture-image" id="battle-player-image" alt="玩家手勢">
                                    <div class="battle-gesture-name" id="battle-player-name">-</div>
                                </div>
                                <div class="battle-vs">VS</div>
                                <div class="battle-ai">
                                    <div class="battle-label">AI 的手勢</div>
                                    <img class="battle-gesture-image" id="battle-ai-image" alt="AI手勢">
                                    <div class="battle-gesture-name" id="battle-ai-name">-</div>
                                </div>
                            </div>

                            <!-- 結果訊息 -->
                            <div class="rps-result-message" id="rps-result-message" style="display: none;">
                                <div class="result-text" id="result-text">-</div>
                            </div>
                        </div>
                    </div>


                </div>
            </article>

            <article class="panel analysis-panel hidden" id="drawing-panel">
                <header class="panel-header">
                    <div>
                        <span class="panel-tag">Sketch Lab</span>
                        <h2>繪畫識別</h2>
                        <p>用手指在空中繪畫。</p>
                    </div>
                </header>

                <div class="panel-body">
                    <!-- 手勢繪畫控制面板 -->
                    <div class="gesture-drawing-controls">
                        <!-- 控制按鈕區域 -->
                        <div class="control-buttons">
                            <button type="button" class="btn primary" id="start-gesture-drawing">開始手勢繪畫</button>
                            <button type="button" class="btn secondary" id="stop-gesture-drawing" disabled>停止繪畫</button>
                        </div>
                    </div>

                    <div class="gesture-drawing-display hidden" id="gesture-drawing-display">
                        <div class="gesture-drawing-header">
                            <h3>🎨 手勢繪畫</h3>
                            <div class="gesture-drawing-stats">
                                <span>模式: <span id="gesture-current-mode">手勢控制</span></span>
                                <span class="divider"></span>
                                <span>顏色: <span id="gesture-current-color">黑色</span></span>
                                <span class="divider"></span>
                                <span>筆劃: <span id="gesture-stroke-count">0</span></span>
                            </div>
                        </div>

                        <div class="gesture-drawing-layout">
                            <div class="gesture-camera-section">
                                <div class="gesture-camera-container">
                                    <!-- 顏色選擇工具列覆蓋層 -->
                                    <div class="color-toolbar" id="gesture-color-toolbar">
                                        <div class="color-zone active" data-color="black"
                                            style="background-color: #111827;">
                                        </div>
                                        <div class="color-zone" data-color="red" style="background-color: #ef4444;">
                                        </div>
                                        <div class="color-zone" data-color="blue" style="background-color: #3b82f6;">
                                        </div>
                                        <div class="color-zone" data-color="green" style="background-color: #22c55e;">
                                        </div>
                                    </div>

                                    <video id="gesture-video" autoplay muted playsinline
                                        style="transform: scaleX(-1);"></video>
                                    <canvas id="gesture-overlay"
                                        style="position: absolute; top: 0; left: 0; pointer-events: none;"></canvas>
                                    <!-- 疊加繪畫畫布 -->
                                    <div class="gesture-canvas-container gesture-overlay-mode">
                                        <canvas id="gesture-canvas"></canvas>
                                        <div class="gesture-canvas-placeholder" id="gesture-canvas-placeholder">
                                            <div class="canvas-message">畫布區域<br><small>你的繪畫將顯示在這裡</small></div>
                                        </div>
                                    </div>
                                    <div class="gesture-hints" id="gesture-hints">準備中...</div>
                                </div>
                            </div>

                            <!-- 最終圖片顯示區域 -->
                            <div class="gesture-final-image-section" id="gesture-final-image-section"
                                style="display: none;">
                                <div class="gesture-final-image-container">
                                    <h4>🎨 完成的作品</h4>
                                    <img id="gesture-final-image" alt="完成的繪畫作品"
                                        style="max-width: 100%; border-radius: 8px;">
                                    <div class="final-image-actions">
                                        <button type="button" class="btn secondary" id="save-final-image">儲存圖片</button>
                                        <button type="button" class="btn ghost" id="new-drawing">重新繪畫</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="gesture-drawing-results hidden" id="gesture-drawing-results">
                        <h3>🎨 繪畫會話結果</h3>
                        <div id="gesture-final-result"></div>
                    </div>
                </div>


                </div>
            </article>
        </section>
    </main>

    <footer class="footer">
        <small>© {{ title }} · Expo Games Interactive Hub</small>
    </footer>

    <script>
        window.appConfig = { pageType: 'main' };
    </script>
    <!-- 使用模組化 JavaScript -->
    <script type="module" src="/static/js/main.js"></script>
</body>

</html>
