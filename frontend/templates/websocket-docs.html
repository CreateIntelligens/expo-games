<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expo Games WebSocket API æ–‡æª”</title>
    <link rel="stylesheet" href="/static/css/websocket-docs.css">
    <script src="/static/js/websocket-docs.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”Œ Expo Games WebSocket API Documentation</h1>
            <p>Complete WebSocket endpoints for real-time communication</p>
        </div>

        <!-- é€£æ¥ç‹€æ…‹æŒ‡ç¤ºå™¨ -->
        <div class="endpoint-card">
            <div class="endpoint-header">
                <div>
                    <span class="status-indicator status-disconnected" id="connectionStatus"></span>
                    <strong>WebSocket é€£æ¥ç‹€æ…‹</strong>
                    <div class="endpoint-description">ç›®å‰é€£æ¥ç‹€æ…‹å’Œæ§åˆ¶</div>
                </div>
            </div>
            <div class="endpoint-content">
                <div class="test-section">
                    <h4>ğŸ”— é€£æ¥æ¸¬è©¦</h4>
                    <div class="input-group">
                        <label>WebSocket URL:</label>
                        <input type="text" id="wsUrl" value="" readonly>
                    </div>
                    <div class="test-controls">
                        <button class="btn btn-primary" id="connectBtn">é€£æ¥</button>
                        <button class="btn btn-danger" id="disconnectBtn">æ–·é–‹</button>
                        <button class="btn btn-success" id="clearLogBtn">æ¸…é™¤æ—¥èªŒ</button>
                    </div>
                    <div class="log-area" id="logArea">ç­‰å¾…é€£æ¥...\n</div>
                </div>
            </div>
        </div>

        <!-- æƒ…ç·’åˆ†æ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/emotion</span>
                    <div class="endpoint-description">å³æ™‚æƒ…ç·’åˆ†æä¸²æµ</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>è™•ç†å³æ™‚æ”å½±æ©Ÿå½±åƒä¸²æµï¼Œé€²è¡Œæƒ…ç·’åˆ†æä¸¦è¿”å›çµæœã€‚æ”¯æ´å¿ƒè·³æ©Ÿåˆ¶å’Œè‡ªå‹•é‡é€£ã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¤ å®¢æˆ¶ç«¯ç™¼é€è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">å½±åƒå¹€è¨Šæ¯ (Frame Message)</div>
                        <pre>{
  "type": "frame",
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šæŒçºŒç™¼é€æ”å½±æ©Ÿå¹€é€²è¡Œå³æ™‚åˆ†æï¼Œå»ºè­° 5-10 FPS</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³è¨Šæ¯ (Ping Message - å¯é¸)</div>
                        <pre>{
  "type": "ping",
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šå¿ƒè·³ç‚ºå¯é¸åŠŸèƒ½ï¼Œå› ç‚ºæŒçºŒçš„å¹€æ•¸æ“šå·²èµ·åˆ°ä¿æ´»ä½œç”¨</p>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ æœå‹™å™¨å›æ‡‰è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">åˆ†æçµæœ (Result Message)</div>
                        <pre>{
  "type": "result",
  "emotion_zh": "é–‹å¿ƒ",
  "emotion_en": "happy",
  "emoji": "ğŸ˜Š",
  "confidence": 0.95,
  "timestamp": 1640995200.123,
  "frame_time": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŒ¯èª¤è¨Šæ¯ (Error Message)</div>
                        <pre>{
  "type": "error",
  "message": "å½±åƒåˆ†æéŒ¯èª¤: ç„¡æ³•æª¢æ¸¬åˆ°äººè‡‰",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³å›æ‡‰ (Pong Response)</div>
                        <pre>"pong"</pre>
                        <p><strong>èªªæ˜</strong>ï¼šæœå‹™ç«¯å›æ‡‰ç´”æ–‡æœ¬ "pong"ï¼Œä¸æ˜¯ JSON æ ¼å¼</p>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ”Œ é€£æ¥ç®¡ç†</h3>
                    
                    <h4>é€£æ¥æ–¹å¼</h4>
                    <div class="code-block">// ç›´æ¥é€£æ¥ï¼Œç„¡éœ€ open è¨Šæ¯
const ws = new WebSocket('ws://localhost:8896/ws/emotion');

ws.onopen = () => {
    console.log('å·²é€£æ¥ï¼Œå¯ä»¥é–‹å§‹ç™¼é€å½±åƒå¹€');
    // ç„¡éœ€ç™¼é€ open è¨Šæ¯ï¼Œç›´æ¥ç™¼é€ frame
};
</div>

                    <h4>åœæ­¢æœƒè©±</h4>
                    <div class="code-block">// æ–¹æ³• 1: ç›´æ¥é—œé–‰é€£æ¥ï¼ˆæ¨è–¦ï¼‰
ws.close(1000, 'ç”¨æˆ¶ä¸»å‹•é—œé–‰');

// æ–¹æ³• 2: åœæ­¢ç™¼é€å¹€ï¼Œä¿æŒé€£æ¥
// åªè¦åœæ­¢ç™¼é€ frame è¨Šæ¯å³å¯ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„åœæ­¢è¨Šæ¯
clearInterval(frameInterval);
</div>

                    <h4>é—œé–‰ä»£ç¢¼èªªæ˜</h4>
                    <div class="code-block">// æ­£å¸¸é—œé–‰ (1000) - æ¨è–¦ç”¨æ–¼ç”¨æˆ¶ä¸»å‹•é—œé–‰
ws.close(1000, 'æƒ…ç·’åˆ†ææœƒè©±çµæŸ');

// ç•°å¸¸é—œé–‰ (1006) - ç¶²è·¯ä¸­æ–·æˆ–æœå‹™å™¨å´©æ½°
// é€šå¸¸ç”±ç€è¦½å™¨è‡ªå‹•è™•ç†ï¼Œä¸éœ€è¦æ‰‹å‹•ç™¼é€

// æœå‹™å™¨éŒ¯èª¤ (1011) - å…§éƒ¨è™•ç†éŒ¯èª¤
// ç”±æœå‹™å™¨ç™¼é€ï¼Œå‰ç«¯é€šå¸¸æ¥æ”¶åˆ°æ­¤ä»£ç¢¼

// ç›£è½é—œé–‰äº‹ä»¶
ws.onclose = (event) => {
    console.log('WebSocket é—œé–‰:', {
        code: event.code,
        reason: event.reason,
        wasClean: event.wasClean
    });

    // æ ¹æ“šé—œé–‰ä»£ç¢¼è™•ç†ä¸åŒæƒ…æ³
    switch(event.code) {
        case 1000:
            console.log('æ­£å¸¸é—œé–‰');
            break;
        case 1001:
            console.log('ç«¯é»é›¢é–‹ï¼Œé é¢å¯èƒ½é‡æ–°è¼‰å…¥');
            break;
        case 1006:
            console.log('ç•°å¸¸é—œé–‰ï¼Œå˜—è©¦é‡é€£');
            // å¯¦ç¾é‡é€£é‚è¼¯
            break;
        case 1011:
            console.log('æœå‹™å™¨éŒ¯èª¤');
            break;
        default:
            console.log('å…¶ä»–é—œé–‰ä»£ç¢¼:', event.code);
    }
};
</div>

                    <h4>å¿ƒè·³æ©Ÿåˆ¶ï¼ˆå¯é¸ï¼‰</h4>
                    <div class="code-block">// å¦‚æœéœ€è¦é¡å¤–çš„å¿ƒè·³ä¿æ´»
setInterval(() => {
    if (ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({ type: 'ping' }));
    }
}, 30000); // æ¯ 30 ç§’ä¸€æ¬¡
</div>
                </div>

                <div class="section">
                    <h3>âš™ï¸ æ•ˆèƒ½åƒæ•¸</h3>
                    <table class="table">
                        <tr><th>åƒæ•¸</th><th>å»ºè­°å€¼</th><th>èªªæ˜</th></tr>
                        <tr><td>å¹€ç‡</td><td>5-10 FPS</td><td>è¦–ç¶²è·¯å’Œè™•ç†èƒ½åŠ›è€Œå®š</td></tr>
                        <tr><td>å½±åƒè§£æåº¦</td><td>å‹•æ…‹é©æ‡‰</td><td>è‡ªå‹•é©æ‡‰æ”å½±æ©Ÿå¯¦éš›è§£æåº¦ (å¦‚ 1920x1080, 1280x720 ç­‰)</td></tr>
                        <tr><td>å£“ç¸®å“è³ª</td><td>0.8 JPEG</td><td>å¹³è¡¡æª”æ¡ˆå¤§å°å’Œå“è³ª</td></tr>
                        <tr><td>ç¶²è·¯å»¶é²</td><td>< 200ms</td><td>å»ºè­°å»¶é²ä¸Šé™</td></tr>
                    </table>
                </div>

                <div class="section">
                    <h3>ğŸ’» ä½¿ç”¨ç¯„ä¾‹</h3>
                    <div class="code-block">// JavaScript å‹•æ…‹è§£æåº¦å½±åƒä¸²æµç¯„ä¾‹
class EmotionStreamClient {
    constructor() {
        this.websocket = null;
        this.videoSize = [640, 480]; // é»˜èªå€¼ï¼Œæœƒå‹•æ…‹èª¿æ•´
        this.captureCanvas = null;
        this.captureContext = null;
    }

    async initializeCamera() {
        // è«‹æ±‚æ”å½±æ©Ÿæ¬Šé™
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { width: { ideal: 640 }, height: { ideal: 480 } }
        });

        // å‹•æ…‹ç²å–å¯¦éš›è§£æåº¦
        const videoTrack = stream.getVideoTracks()[0];
        const settings = videoTrack.getSettings();
        this.videoSize = [
            settings.width || 640,
            settings.height || 480
        ];

        console.log('æ”å½±æ©Ÿå¯¦éš›è§£æåº¦:', this.videoSize);

        // å‰µå»ºå‹•æ…‹å°ºå¯¸çš„æ•ç²ç•«å¸ƒ
        this.captureCanvas = document.createElement('canvas');
        this.captureCanvas.width = this.videoSize[0];
        this.captureCanvas.height = this.videoSize[1];
        this.captureContext = this.captureCanvas.getContext('2d');

        // è¨­ç½®videoå…ƒç´ 
        const videoElement = document.createElement('video');
        videoElement.srcObject = stream;
        videoElement.play();

        return videoElement;
    }

    startStreaming(videoElement) {
        // å®šæœŸç™¼é€å½±åƒå¹€
        setInterval(() => {
            if (this.websocket && this.websocket.readyState === WebSocket.OPEN) {
                // ä½¿ç”¨å‹•æ…‹è§£æåº¦æ•ç²å½±åƒ
                this.captureContext.drawImage(videoElement, 0, 0, this.videoSize[0], this.videoSize[1]);
                const imageData = this.captureCanvas.toDataURL('image/jpeg', 0.8);

                const message = {
                    type: 'frame',
                    image: imageData,
                    timestamp: Date.now() / 1000
                };

                this.websocket.send(JSON.stringify(message));
            }
        }, 200); // 5 FPS
    }
}</div>
                </div>
            </div>
        </div>

        <!-- å‹•ä½œæª¢æ¸¬ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/action</span>
                    <div class="endpoint-description">å‹•ä½œæª¢æ¸¬ç‹€æ…‹å»£æ’­</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>å³æ™‚å»£æ’­å‹•ä½œæª¢æ¸¬éŠæˆ²çš„ç‹€æ…‹æ›´æ–°å’Œçµæœã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ”Œ é€£æ¥ç®¡ç†</h3>

                    <h4>é€£æ¥æ–¹å¼</h4>
                    <div class="code-block">// å»£æ’­å‹ WebSocketï¼Œç„¡éœ€ç™¼é€è¨Šæ¯å³å¯æ¥æ”¶ç‹€æ…‹æ›´æ–°
const ws = new WebSocket('ws://localhost:8896/ws/action');

ws.onopen = () => {
    console.log('å·²é€£æ¥å‹•ä½œæª¢æ¸¬å»£æ’­');
    // ç„¡éœ€ç™¼é€ä»»ä½•è¨Šæ¯ï¼Œç›´æ¥æ¥æ”¶å»£æ’­
};
</div>

                    <h4>é—œé–‰é€£æ¥</h4>
                    <div class="code-block">// æ­£å¸¸é—œé–‰ (1000) - ç”¨æˆ¶ä¸»å‹•æ–·é–‹
ws.close(1000, 'åœæ­¢æ¥æ”¶å‹•ä½œæª¢æ¸¬å»£æ’­');

// ç›£è½é—œé–‰äº‹ä»¶
ws.onclose = (event) => {
    console.log('å‹•ä½œæª¢æ¸¬ WebSocket é—œé–‰:', {
        code: event.code,
        reason: event.reason,
        wasClean: event.wasClean
    });

    // æ ¹æ“šé—œé–‰ä»£ç¢¼è™•ç†
    switch(event.code) {
        case 1000:
            console.log('æ­£å¸¸é—œé–‰å»£æ’­é€£æ¥');
            break;
        case 1006:
            console.log('å»£æ’­é€£æ¥ç•°å¸¸ä¸­æ–·');
            break;
        default:
            console.log('å»£æ’­é€£æ¥é—œé–‰ï¼Œä»£ç¢¼:', event.code);
    }
};
</div>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ å»£æ’­è¨Šæ¯æ ¼å¼</h3>

                    <div class="message-example">
                        <div class="message-type">éŠæˆ²é–‹å§‹ (Game Start)</div>
                        <pre>{
  "channel": "action",
  "type": "game_start",
  "difficulty": "medium",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">æª¢æ¸¬çµæœ (Detection Result)</div>
                        <pre>{
  "channel": "action",
  "type": "detection_result",
  "action": "jump",
  "confidence": 0.87,
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">ç‹€æ…‹æ›´æ–° (Status Update)</div>
                        <pre>{
  "channel": "action",
  "type": "status_update",
  "status": "running",
  "current_action": "raise_hand",
  "time_remaining": 45.2,
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‰‹å‹¢è­˜åˆ¥ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/gesture</span>
                    <div class="endpoint-description">æ‰‹å‹¢è­˜åˆ¥çµæœå»£æ’­</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>å³æ™‚å»£æ’­æ‰‹å‹¢è­˜åˆ¥çµæœå’Œç‹€æ…‹æ›´æ–°ã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ”Œ é€£æ¥ç®¡ç†</h3>

                    <h4>é€£æ¥æ–¹å¼</h4>
                    <div class="code-block">// å»£æ’­å‹ WebSocketï¼Œç„¡éœ€ç™¼é€è¨Šæ¯å³å¯æ¥æ”¶æ‰‹å‹¢è¾¨è­˜çµæœ
const ws = new WebSocket('ws://localhost:8896/ws/gesture');

ws.onopen = () => {
    console.log('å·²é€£æ¥æ‰‹å‹¢è­˜åˆ¥å»£æ’­');
    // ç„¡éœ€ç™¼é€ä»»ä½•è¨Šæ¯ï¼Œç›´æ¥æ¥æ”¶å»£æ’­
};
</div>

                    <h4>é—œé–‰é€£æ¥</h4>
                    <div class="code-block">// æ­£å¸¸é—œé–‰ (1000) - ç”¨æˆ¶ä¸»å‹•åœæ­¢æ¥æ”¶
ws.close(1000, 'åœæ­¢æ¥æ”¶æ‰‹å‹¢è­˜åˆ¥å»£æ’­');

// ç›£è½é—œé–‰äº‹ä»¶
ws.onclose = (event) => {
    console.log('æ‰‹å‹¢è­˜åˆ¥ WebSocket é—œé–‰:', {
        code: event.code,
        reason: event.reason,
        wasClean: event.wasClean
    });

    // æ ¹æ“šé—œé–‰ä»£ç¢¼è™•ç†
    switch(event.code) {
        case 1000:
            console.log('æ­£å¸¸é—œé–‰æ‰‹å‹¢å»£æ’­é€£æ¥');
            break;
        case 1006:
            console.log('æ‰‹å‹¢å»£æ’­é€£æ¥ç•°å¸¸ä¸­æ–·');
            break;
        default:
            console.log('æ‰‹å‹¢å»£æ’­é€£æ¥é—œé–‰ï¼Œä»£ç¢¼:', event.code);
    }
};
</div>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ å»£æ’­è¨Šæ¯æ ¼å¼</h3>

                    <div class="message-example">
                        <div class="message-type">æ‰‹å‹¢æª¢æ¸¬ (Gesture Detected)</div>
                        <pre>{
  "channel": "gesture",
  "type": "gesture_detected",
  "gesture": "thumbs_up",
  "confidence": 0.92,
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">ç‹€æ…‹æ›´æ–° (Status Update)</div>
                        <pre>{
  "channel": "gesture",
  "type": "status_update",
  "status": "running",
  "uptime": 30,
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- çŒœæ‹³æ•´åˆå¼ WebSocket (MediaPipe ç‰ˆæœ¬) -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/rps</span>
                    <div class="endpoint-description">çŒœæ‹³éŠæˆ²</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p><strong>å–®ä¸€ WebSocket æ•´åˆæ‰€æœ‰åŠŸèƒ½</strong>ï¼šéŠæˆ²æ§åˆ¶ + å³æ™‚å½±åƒä¸²æµè¾¨è­˜ + ç‹€æ…‹å»£æ’­</p>
                    <p><strong>æŠ€è¡“æ¶æ§‹</strong>ï¼šMediaPipe å³æ™‚è¾¨è­˜ + å–®ä¸€ WebSocket é›™å‘é€šè¨Š + è‡ªå‹•æ‰‹å‹¢æäº¤</p>
                    <p><strong>å„ªå‹¢</strong>ï¼šé–‹ç™¼è€…åªéœ€é€£ç·šä¸€å€‹ç«¯é»ï¼Œç°¡åŒ–æ•´åˆæµç¨‹</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¤ å®¢æˆ¶ç«¯ç™¼é€è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³è¨Šæ¯ (Ping Message)</div>
                        <pre>{
  "type": "ping"
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šä¿æŒé€£æ¥æ´»èºçš„å¯é¸è¨Šæ¯</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŠæˆ²æ§åˆ¶ (Game Control)</div>
                        <pre>{
  "type": "game_control",
  "action": "start_game",
  "target_score": 1
}</pre>
                        <p><strong>action å€¼</strong>ï¼š<code>"start_game"</code>, <code>"stop_game"</code></p>
                        <p><strong>èªªæ˜</strong>ï¼šé–‹å§‹æˆ–åœæ­¢éŠæˆ²æœƒè©±</p>
                        <p><strong>target_score</strong>ï¼šå›ºå®šç‚º 1ï¼ˆå–®å›åˆæ¨¡å¼ï¼‰ï¼Œä¿ç•™ç‚º API ç›¸å®¹æ€§</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å½±åƒå¹€ (Frame Message)</div>
                        <pre>{
  "type": "frame",
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šæŒçºŒç™¼é€æ”å½±æ©Ÿå¹€é€²è¡Œå³æ™‚æ‰‹å‹¢è¾¨è­˜ï¼Œå»ºè­° 5 FPS</p>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ æœå‹™å™¨å›æ‡‰è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">æ§åˆ¶ç¢ºèª (Control Ack)</div>
                        <pre>{
  "type": "control_ack",
  "action": "start_game",
  "status": "started",
  "message": "éŠæˆ²å·²é–‹å§‹"
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šå°éŠæˆ²æ§åˆ¶æŒ‡ä»¤çš„å›æ‡‰</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">è¾¨è­˜çµæœ (Recognition Result)</div>
                        <pre>{
  "type": "recognition_result",
  "gesture": "rock",
  "confidence": 0.96,
  "timestamp": 1640995200.123,
  "is_valid": true
}</pre>
                        <p><strong>gesture å€¼</strong>ï¼š<code>"rock"</code>, <code>"paper"</code>, <code>"scissors"</code>, <code>"unknown"</code></p>
                        <p><strong>èªªæ˜</strong>ï¼šå³æ™‚æ‰‹å‹¢è¾¨è­˜çµæœ</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŠæˆ²ç‹€æ…‹ (Game State)</div>
                        <pre>{
  "type": "game_state",
  "stage": "waiting_player",
  "message": "ç­‰å¾…ç©å®¶å‡ºæ‹³",
  "data": {
    "round": 1,
    "scores": {"player": 0, "computer": 0}
  }
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šéŠæˆ²ç‹€æ…‹å»£æ’­è¨Šæ¯</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŒ¯èª¤è¨Šæ¯ (Error Message)</div>
                        <pre>{
  "type": "error",
  "message": "è¾¨è­˜å¤±æ•—",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³å›æ‡‰ (Pong Response)</div>
                        <pre>{
  "type": "pong"
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šå° ping è¨Šæ¯çš„å›æ‡‰</p>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ® éŠæˆ²ç‹€æ…‹å»£æ’­æ ¼å¼ï¼ˆ8 ç¨®éšæ®µï¼‰</h3>

                    <div class="message-example">
                        <div class="message-type">1ï¸âƒ£ éŠæˆ²é–‹å§‹ (game_started)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "game_started",
  "message": "çŒœæ‹³éŠæˆ²é–‹å§‹ï¼",
  "data": {
    "target_score": 1,
    "player_score": 0,
    "computer_score": 0
  },
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šå–®å›åˆæ¨¡å¼ï¼Œä¸€æ¬¡å°æ±ºå¾Œè‡ªå‹•çµæŸ</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">2ï¸âƒ£ å›åˆé–‹å§‹ (round_started)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "round_started",
  "message": "ç¬¬ 1 å›åˆé–‹å§‹",
  "data": {
    "round": 1,
    "scores": {"player": 0, "computer": 0}
  },
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">3ï¸âƒ£ å€’æ•¸è¨ˆæ™‚ (countdown)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "countdown",
  "message": "å€’æ•¸: 3",
  "data": {"count": 3},
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>å‰ç«¯å»ºè­°</strong>ï¼šä½¿ç”¨å¤§å°ºå¯¸æ•¸å­—å‹•ç•«é¡¯ç¤ºå€’æ•¸ï¼Œåƒè€ƒ CSS å‹•ç•« <code>countdownPulse</code></p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">4ï¸âƒ£ ç­‰å¾…ç©å®¶å‡ºæ‹³ (waiting_player)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "waiting_player",
  "message": "è«‹ä¸Šå‚³ä½ çš„æ‰‹å‹¢ï¼",
  "data": {},
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šç­‰å¾…ç©å®¶æ‰‹å‹¢è¾¨è­˜ï¼Œç³»çµ±æœƒè‡ªå‹•é€é WebSocket å³æ™‚è¾¨è­˜æ”å½±æ©Ÿå½±åƒ</p>
                        <p><strong>è‡ªå‹•è¨­å®š</strong>ï¼šç•¶æ‰‹å‹¢ä¿¡å¿ƒåº¦ > 60% æ™‚ï¼Œå¾Œç«¯è‡ªå‹•è¨­å®šç©å®¶æ‰‹å‹¢</p>
                        <p><strong>è¶…æ™‚è™•ç†</strong>ï¼šæœ€å¤šç­‰å¾… 10 ç§’ï¼Œè‹¥æœªè¾¨è­˜åˆ°æœ‰æ•ˆæ‰‹å‹¢å‰‡è¦–ç‚º UNKNOWN</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">5ï¸âƒ£ å›åˆçµæœ (result)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "result",
  "message": "ä½ è´äº†ï¼",
  "data": {
    "result": "win",
    "gestures": {
      "player": "rock",
      "computer": "scissors"
    },
    "scores": {"player": 1, "computer": 0},
    "round": 1
  },
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>result å€¼</strong>ï¼š<code>"win"</code>, <code>"lose"</code>, <code>"draw"</code></p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">6ï¸âƒ£ éŠæˆ²çµæŸ (game_finished)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "game_finished",
  "message": "éŠæˆ²çµæŸï¼ç©å®¶ç²å‹ï¼",
  "data": {
    "winner": "player",
    "final_scores": {"player": 3, "computer": 1},
    "total_rounds": 4,
    "duration": 45.2
  },
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">7ï¸âƒ£ éŠæˆ²åœæ­¢ (game_stopped)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "game_stopped",
  "message": "éŠæˆ²å·²åœæ­¢",
  "data": {
    "reason": "user_request",
    "final_scores": {"player": 1, "computer": 1}
  },
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">8ï¸âƒ£ éŒ¯èª¤è¨Šæ¯ (error)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "error",
  "message": "è¶…æ™‚æœªå‡ºæ‹³ï¼Œæœ¬å›åˆåˆ¤å®šå¤±æ•—",
  "data": {
    "error_type": "timeout",
    "round": 2
  },
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ® å®Œå…¨ WebSocket æ¶æ§‹</h3>
                    <p>RPS éŠæˆ²å®Œå…¨é€é WebSocket æ§åˆ¶ï¼Œä¸ä½¿ç”¨ REST APIï¼š</p>
                    <ul>
                        <li>âœ… éŠæˆ²æ§åˆ¶é€é <code>game_control</code> è¨Šæ¯</li>
                        <li>âœ… å½±åƒä¸²æµé€é <code>frame</code> è¨Šæ¯</li>
                        <li>âœ… ç‹€æ…‹æ›´æ–°é€é <code>game_state</code> å»£æ’­</li>
                        <li>âœ… è‡ªå‹•æ‰‹å‹¢è¾¨è­˜ï¼ˆä¿¡å¿ƒåº¦ > 60%ï¼‰</li>
                    </ul>
                </div>

                <div class="section">
                    <h3>ğŸ”Œ é€£æ¥ç®¡ç†</h3>

                    <h4>é€£æ¥æ–¹å¼</h4>
                    <div class="code-block">// æ•´åˆå¼ WebSocketï¼Œæ”¯æ´éŠæˆ²æ§åˆ¶å’Œå³æ™‚ä¸²æµ
const ws = new WebSocket('ws://localhost:8896/ws/rps');

ws.onopen = () => {
    console.log('å·²é€£æ¥çŒœæ‹³éŠæˆ² WebSocket');
    // é€£æ¥å¾Œå¯ä»¥é–‹å§‹ç™¼é€ game_control è¨Šæ¯æˆ– frame è¨Šæ¯
};
</div>

                    <h4>é—œé–‰é€£æ¥</h4>
                    <div class="code-block">// æ­£å¸¸é—œé–‰ (1000) - ç”¨æˆ¶çµæŸéŠæˆ²æœƒè©±
ws.close(1000, 'çŒœæ‹³éŠæˆ²æœƒè©±çµæŸ');

// éŠæˆ²åœæ­¢ (1000) - é€é stop_game è¨Šæ¯å¾Œé—œé–‰
// å…ˆç™¼é€ stop_game è¨Šæ¯ï¼Œæ”¶åˆ° game_stopped å›æ‡‰å¾Œé—œé–‰
ws.send(JSON.stringify({
    type: 'game_control',
    action: 'stop_game'
}));
// ç­‰å¾… game_stopped å›æ‡‰ï¼Œç„¶å¾Œ:
ws.close(1000, 'éŠæˆ²æ­£å¸¸çµæŸ');

// ç›£è½é—œé–‰äº‹ä»¶
ws.onclose = (event) => {
    console.log('çŒœæ‹³éŠæˆ² WebSocket é—œé–‰:', {
        code: event.code,
        reason: event.reason,
        wasClean: event.wasClean
    });

    // æ ¹æ“šé—œé–‰ä»£ç¢¼è™•ç†
    switch(event.code) {
        case 1000:
            console.log('æ­£å¸¸é—œé–‰éŠæˆ²é€£æ¥');
            break;
        case 1006:
            console.log('éŠæˆ²é€£æ¥ç•°å¸¸ä¸­æ–·ï¼Œå¯èƒ½éœ€è¦é‡æ–°é€£ç·š');
            break;
        case 1011:
            console.log('éŠæˆ²æœå‹™å™¨éŒ¯èª¤');
            break;
        default:
            console.log('éŠæˆ²é€£æ¥é—œé–‰ï¼Œä»£ç¢¼:', event.code);
    }
};
</div>
                </div>

                <div class="section">
                    <h3>ğŸ¯ éŠæˆ²æµç¨‹åœ–</h3>
                    <div class="code-block">IDLE â†’ game_started â†’ round_started â†’ countdown â†’ waiting_player â†’
  result â†’ game_finished â†’ï¼ˆå‰ç«¯ stopGameï¼‰â†’ IDLE</div>
                </div>


        <!-- æ‰‹å‹¢ç¹ªç•« WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/drawing</span>
                    <div class="endpoint-description">å³æ™‚æ‰‹å‹¢ç¹ªç•«æ§åˆ¶</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>è™•ç†å³æ™‚æ‰‹å‹¢æ§åˆ¶çš„ç¹ªç•«åŠŸèƒ½ï¼Œæ”¯æ´ç©ºä¸­æ‰‹å‹¢ç¹ªç•«ã€é¡è‰²é¸æ“‡å’Œç•«å¸ƒæ¸…ç©ºã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¤ å®¢æˆ¶ç«¯ç™¼é€è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">å•Ÿå‹•æ‰‹å‹¢ç¹ªç•« (Start Gesture Drawing)</div>
                        <pre>{
  "type": "start_gesture_drawing",
  "mode": "gesture_control",
  "color": "blue",
  "canvas_size": [720, 1280],
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">æ”å½±æ©Ÿå¹€ (Camera Frame)</div>
                        <pre>{
  "type": "camera_frame",
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">åœæ­¢ç¹ªç•« (Stop Drawing)</div>
                        <pre>{
  "type": "stop_drawing",
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ æœå‹™å™¨å›æ‡‰è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">ç¹ªç•«é–‹å§‹ç¢ºèª (Drawing Started)</div>
                        <pre>{
  "type": "drawing_started",
  "session_id": "gesture_12345",
  "canvas_size": [720, 1280],
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">æ‰‹å‹¢ç‹€æ…‹æ›´æ–° (Gesture Status)</div>
                        <pre>{
  "type": "gesture_status",
  "current_gesture": "drawing",
  "fingers_up": [false, true, false, false, false],
  "drawing_position": [320, 240],
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">ç•«å¸ƒæ›´æ–° (Canvas Update)</div>
                        <pre>{
  "type": "canvas_update",
  "canvas_base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
  "stroke_count": 15,
  "current_color": "blue",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">AIè­˜åˆ¥çµæœ (AI Recognition)</div>
                        <pre>{
  "type": "recognition_result",
  "recognized_shape": "circle",
  "confidence": 0.87,
  "message": "æˆ‘çœ‹åˆ°ä¸€å€‹åœ“å½¢ï¼(éå¸¸ç¢ºå®š)",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŒ¯èª¤è¨Šæ¯ (Error Message)</div>
                        <pre>{
  "type": "error",
  "message": "MediaPipe åˆå§‹åŒ–å¤±æ•—",
  "error_code": "MEDIA_PIPE_ERROR",
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ¤ æ‰‹å‹¢èªªæ˜</h3>
                    <table class="table">
                        <tr>
                            <th>æ‰‹å‹¢</th>
                            <th>èªªæ˜</th>
                            <th>å°æ‡‰å‹•ä½œ</th>
                        </tr>
                        <tr>
                            <td><strong>ğŸ‘† é£ŸæŒ‡ä¼¸å‡º</strong></td>
                            <td>åƒ…é£ŸæŒ‡ä¼¸ç›´ï¼Œå…¶ä»–æ‰‹æŒ‡å½æ›²</td>
                            <td>ç¹ªç•«æ¨¡å¼ - ä½¿ç”¨é£ŸæŒ‡å°–ç«¯ç¹ªç•«</td>
                        </tr>
                        <tr>
                            <td><strong>âœŒï¸ é›™æŒ‡ä¼¸å‡º</strong></td>
                            <td>é£ŸæŒ‡å’Œä¸­æŒ‡ä¼¸ç›´</td>
                            <td>é¸æ“‡æ¨¡å¼ - æ©¡çš®æ“¦åŠŸèƒ½</td>
                        </tr>
                        <tr>
                            <td><strong>âœ‹ äº”æŒ‡å…¨é–‹</strong></td>
                            <td>æ‰€æœ‰æ‰‹æŒ‡å®Œå…¨ä¼¸ç›´</td>
                            <td>æ¸…ç©ºæ¨¡å¼ - æ¸…ç©ºæ•´å€‹ç•«å¸ƒ</td>
                        </tr>
                    </table>
                </div>

                <div class="section">
                    <h3>âš™ï¸ æ•ˆèƒ½åƒæ•¸</h3>
                    <table class="table">
                        <tr><th>åƒæ•¸</th><th>å»ºè­°å€¼</th><th>èªªæ˜</th></tr>
                        <tr><td>å¹€ç‡</td><td>20-30 FPS</td><td>å¹³è¡¡å³æ™‚æ€§å’Œè™•ç†æ•ˆèƒ½</td></tr>
                        <tr><td>å½±åƒè§£æåº¦</td><td>å‹•æ…‹é©æ‡‰</td><td>è‡ªå‹•é©æ‡‰æ”å½±æ©Ÿå¯¦éš›è§£æåº¦ (å¦‚ 1920x1080, 1280x720 ç­‰)</td></tr>
                        <tr><td>æ‰‹å‹¢ç©©å®šæ€§</td><td>3å¹€ç¢ºèª</td><td>é¿å…æŠ–å‹•èª¤è§¸</td></tr>
                        <tr><td>ç¶²è·¯å»¶é²</td><td>< 50ms</td><td>ç¢ºä¿å³æ™‚äº’å‹•é«”é©—</td></tr>
                    </table>
                </div>

                <div class="section">
                    <h3>ğŸ”Œ é€£æ¥ç®¡ç†</h3>

                    <h4>é€£æ¥æ–¹å¼</h4>
                    <div class="code-block">// æ‰‹å‹¢ç¹ªç•« WebSocketï¼Œéœ€è¦å…ˆç™¼é€å•Ÿå‹•è¨Šæ¯
const ws = new WebSocket('ws://localhost:8896/ws/drawing');

ws.onopen = () => {
    console.log('å·²é€£æ¥æ‰‹å‹¢ç¹ªç•« WebSocket');
    // é€£æ¥å¾Œéœ€è¦ç™¼é€ start_gesture_drawing è¨Šæ¯ä¾†åˆå§‹åŒ–ç¹ªç•«æœƒè©±
};
</div>

                    <h4>é—œé–‰é€£æ¥</h4>
                    <div class="code-block">// æ­£å¸¸é—œé–‰ (1000) - ç”¨æˆ¶çµæŸç¹ªç•«æœƒè©±
ws.close(1000, 'æ‰‹å‹¢ç¹ªç•«æœƒè©±çµæŸ');

// åœæ­¢ç¹ªç•«å¾Œé—œé–‰
// å…ˆç™¼é€ stop_drawing è¨Šæ¯ï¼Œç„¶å¾Œé—œé–‰é€£æ¥
ws.send(JSON.stringify({
    type: 'stop_drawing',
    timestamp: Date.now() / 1000
}));
// ç­‰å¾…æœ€å¾Œçš„ canvas_update å›æ‡‰ï¼Œç„¶å¾Œ:
ws.close(1000, 'ç¹ªç•«æœƒè©±æ­£å¸¸çµæŸ');

// ç›£è½é—œé–‰äº‹ä»¶
ws.onclose = (event) => {
    console.log('æ‰‹å‹¢ç¹ªç•« WebSocket é—œé–‰:', {
        code: event.code,
        reason: event.reason,
        wasClean: event.wasClean
    });

    // æ ¹æ“šé—œé–‰ä»£ç¢¼è™•ç†
    switch(event.code) {
        case 1000:
            console.log('æ­£å¸¸é—œé–‰ç¹ªç•«é€£æ¥');
            break;
        case 1006:
            console.log('ç¹ªç•«é€£æ¥ç•°å¸¸ä¸­æ–·');
            break;
        case 1011:
            console.log('ç¹ªç•«æœå‹™å™¨éŒ¯èª¤');
            break;
        default:
            console.log('ç¹ªç•«é€£æ¥é—œé–‰ï¼Œä»£ç¢¼:', event.code);
    }
};
</div>
                </div>

                <div class="section">
                    <h3>ğŸ’» ä½¿ç”¨ç¯„ä¾‹</h3>
                    <div class="code-block">// JavaScript æ‰‹å‹¢ç¹ªç•«æ•´åˆç¯„ä¾‹
class GestureDrawingClient {
    constructor() {
        this.ws = null;
        this.canvas = document.getElementById('drawing-canvas');
        this.setupWebSocket();
        this.setupCamera();
    }

    setupWebSocket() {
        this.ws = new WebSocket('ws://localhost:8896/ws/drawing');

        this.ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            this.handleServerMessage(data);
        };
    }

    async startDrawing() {
        // å•Ÿå‹•æ”å½±æ©Ÿ
        const stream = await navigator.mediaDevices.getUserMedia({video: true});
        this.videoElement.srcObject = stream;

        // ç™¼é€å•Ÿå‹•è¨Šæ¯
        this.ws.send(JSON.stringify({
            type: 'start_gesture_drawing',
            mode: 'gesture_control',
            color: 'blue',
            canvas_size: [720, 1280],
            timestamp: Date.now() / 1000
        }));
    }

    handleServerMessage(data) {
        switch(data.type) {
            case 'canvas_update':
                this.updateCanvas(data.canvas_base64);
                break;
            case 'gesture_status':
                this.updateGestureHints(data.current_gesture);
                break;
            case 'recognition_result':
                this.showRecognitionResult(data);
                break;
        }
    }
}</div>
                </div>
            </div>
        </div>

        <!-- é—œé–‰ä»£ç¢¼åƒè€ƒ -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">REF</span>
                    <span class="endpoint-url">WebSocket é—œé–‰ä»£ç¢¼</span>
                    <div class="endpoint-description">æ¨™æº–é—œé–‰ä»£ç¢¼å®šç¾©</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <table class="table">
                    <tr>
                        <th>ä»£ç¢¼</th>
                        <th>åç¨±</th>
                        <th>èªªæ˜</th>
                        <th>è§¸ç™¼æ¢ä»¶</th>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">1000</span></td>
                        <td>CLOSE_NORMAL</td>
                        <td>æ­£å¸¸é—œé–‰</td>
                        <td>å‰ç«¯å‘¼å« close() æˆ–æ­£å¸¸çµæŸ</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-info">1001</span></td>
                        <td>CLOSE_GOING_AWAY</td>
                        <td>ç«¯é»é›¢é–‹</td>
                        <td>é é¢é‡æ–°è¼‰å…¥ã€å°èˆªé›¢é–‹</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-error">1006</span></td>
                        <td>CLOSE_ABNORMAL</td>
                        <td>ç•°å¸¸é—œé–‰</td>
                        <td>ç¶²è·¯ä¸­æ–·ã€ä¼ºæœå™¨å´©æ½°</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-error">1008</span></td>
                        <td>CLOSE_POLICY_VIOLATION</td>
                        <td>é•åæ”¿ç­–</td>
                        <td>è¨Šæ¯æ ¼å¼éŒ¯èª¤ã€ç„¡æ•ˆæ•¸æ“š</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-error">1011</span></td>
                        <td>CLOSE_SERVER_ERROR</td>
                        <td>ä¼ºæœå™¨éŒ¯èª¤</td>
                        <td>å…§éƒ¨è™•ç†éŒ¯èª¤</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
