<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expo Games WebSocket API æ–‡æª”</title>
    <link rel="stylesheet" href="/static/css/websocket-docs.css">
    <script src="/static/js/websocket-docs.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”Œ Expo Games WebSocket API</h1>
            <p>å³æ™‚é›™å‘é€šè¨Šå”è­°æ–‡æª”èˆ‡æ¸¬è©¦å·¥å…·</p>
        </div>

        <!-- é€£æ¥ç‹€æ…‹æŒ‡ç¤ºå™¨ -->
        <div class="endpoint-card">
            <div class="endpoint-header">
                <div>
                    <span class="status-indicator status-disconnected" id="connectionStatus"></span>
                    <strong>WebSocket é€£æ¥ç‹€æ…‹</strong>
                    <div class="endpoint-description">ç›®å‰é€£æ¥ç‹€æ…‹å’Œæ§åˆ¶</div>
                </div>
            </div>
            <div class="endpoint-content">
                <div class="test-section">
                    <h4>ğŸ”— é€£æ¥æ¸¬è©¦</h4>
                    <div class="input-group">
                        <label>WebSocket URL:</label>
                        <input type="text" id="wsUrl" value="" readonly>
                    </div>
                    <div class="test-controls">
                        <button class="btn btn-primary" id="connectBtn">é€£æ¥</button>
                        <button class="btn btn-danger" id="disconnectBtn">æ–·é–‹</button>
                        <button class="btn btn-success" id="clearLogBtn">æ¸…é™¤æ—¥èªŒ</button>
                    </div>
                    <div class="log-area" id="logArea">ç­‰å¾…é€£æ¥...\n</div>
                </div>
            </div>
        </div>

        <!-- æƒ…ç·’åˆ†æ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/emotion</span>
                    <div class="endpoint-description">å³æ™‚æƒ…ç·’åˆ†æä¸²æµ</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>è™•ç†å³æ™‚æ”å½±æ©Ÿå½±åƒä¸²æµï¼Œé€²è¡Œæƒ…ç·’åˆ†æä¸¦è¿”å›çµæœã€‚æ”¯æ´å¿ƒè·³æ©Ÿåˆ¶å’Œè‡ªå‹•é‡é€£ã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¤ å®¢æˆ¶ç«¯ç™¼é€è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">å½±åƒå¹€è¨Šæ¯ (Frame Message)</div>
                        <pre>{
  "type": "frame",
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šæŒçºŒç™¼é€æ”å½±æ©Ÿå¹€é€²è¡Œå³æ™‚åˆ†æï¼Œå»ºè­° 5-10 FPS</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³è¨Šæ¯ (Ping Message - å¯é¸)</div>
                        <pre>{
  "type": "ping",
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šå¿ƒè·³ç‚ºå¯é¸åŠŸèƒ½ï¼Œå› ç‚ºæŒçºŒçš„å¹€æ•¸æ“šå·²èµ·åˆ°ä¿æ´»ä½œç”¨</p>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ æœå‹™å™¨å›æ‡‰è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">åˆ†æçµæœ (Result Message)</div>
                        <pre>{
  "type": "result",
  "emotion_zh": "é–‹å¿ƒ",
  "emotion_en": "happy",
  "emoji": "ğŸ˜Š",
  "confidence": 0.95,
  "timestamp": 1640995200.123,
  "frame_time": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŒ¯èª¤è¨Šæ¯ (Error Message)</div>
                        <pre>{
  "type": "error",
  "message": "å½±åƒåˆ†æéŒ¯èª¤: ç„¡æ³•æª¢æ¸¬åˆ°äººè‡‰",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³å›æ‡‰ (Pong Response)</div>
                        <pre>"pong"</pre>
                        <p><strong>èªªæ˜</strong>ï¼šæœå‹™ç«¯å›æ‡‰ç´”æ–‡æœ¬ "pong"ï¼Œä¸æ˜¯ JSON æ ¼å¼</p>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ”Œ é€£æ¥ç®¡ç†</h3>
                    
                    <h4>é€£æ¥æ–¹å¼</h4>
                    <div class="code-block">// ç›´æ¥é€£æ¥ï¼Œç„¡éœ€ open è¨Šæ¯
const ws = new WebSocket('ws://localhost:8896/ws/emotion');

ws.onopen = () => {
    console.log('å·²é€£æ¥ï¼Œå¯ä»¥é–‹å§‹ç™¼é€å½±åƒå¹€');
    // ç„¡éœ€ç™¼é€ open è¨Šæ¯ï¼Œç›´æ¥ç™¼é€ frame
};
</div>

                    <h4>åœæ­¢æœƒè©±</h4>
                    <div class="code-block">// æ–¹æ³• 1: ç›´æ¥é—œé–‰é€£æ¥ï¼ˆæ¨è–¦ï¼‰
ws.close(1000, 'ç”¨æˆ¶ä¸»å‹•é—œé–‰');

// æ–¹æ³• 2: åœæ­¢ç™¼é€å¹€ï¼Œä¿æŒé€£æ¥
// åªè¦åœæ­¢ç™¼é€ frame è¨Šæ¯å³å¯ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„åœæ­¢è¨Šæ¯
clearInterval(frameInterval);
</div>

                    <h4>å¿ƒè·³æ©Ÿåˆ¶ï¼ˆå¯é¸ï¼‰</h4>
                    <div class="code-block">// å¦‚æœéœ€è¦é¡å¤–çš„å¿ƒè·³ä¿æ´»
setInterval(() => {
    if (ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({ type: 'ping' }));
    }
}, 30000); // æ¯ 30 ç§’ä¸€æ¬¡
</div>
                </div>

                <div class="section">
                    <h3>âš™ï¸ æ•ˆèƒ½åƒæ•¸</h3>
                    <table class="table">
                        <tr><th>åƒæ•¸</th><th>å»ºè­°å€¼</th><th>èªªæ˜</th></tr>
                        <tr><td>å¹€ç‡</td><td>5-10 FPS</td><td>è¦–ç¶²è·¯å’Œè™•ç†èƒ½åŠ›è€Œå®š</td></tr>
                        <tr><td>å½±åƒè§£æåº¦</td><td>å‹•æ…‹é©æ‡‰</td><td>è‡ªå‹•é©æ‡‰æ”å½±æ©Ÿå¯¦éš›è§£æåº¦ (å¦‚ 1920x1080, 1280x720 ç­‰)</td></tr>
                        <tr><td>å£“ç¸®å“è³ª</td><td>0.8 JPEG</td><td>å¹³è¡¡æª”æ¡ˆå¤§å°å’Œå“è³ª</td></tr>
                        <tr><td>ç¶²è·¯å»¶é²</td><td>< 200ms</td><td>å»ºè­°å»¶é²ä¸Šé™</td></tr>
                    </table>
                </div>

                <div class="section">
                    <h3>ğŸ’» ä½¿ç”¨ç¯„ä¾‹</h3>
                    <div class="code-block">// JavaScript å‹•æ…‹è§£æåº¦å½±åƒä¸²æµç¯„ä¾‹
class EmotionStreamClient {
    constructor() {
        this.websocket = null;
        this.videoSize = [640, 480]; // é»˜èªå€¼ï¼Œæœƒå‹•æ…‹èª¿æ•´
        this.captureCanvas = null;
        this.captureContext = null;
    }

    async initializeCamera() {
        // è«‹æ±‚æ”å½±æ©Ÿæ¬Šé™
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { width: { ideal: 640 }, height: { ideal: 480 } }
        });

        // å‹•æ…‹ç²å–å¯¦éš›è§£æåº¦
        const videoTrack = stream.getVideoTracks()[0];
        const settings = videoTrack.getSettings();
        this.videoSize = [
            settings.width || 640,
            settings.height || 480
        ];

        console.log('æ”å½±æ©Ÿå¯¦éš›è§£æåº¦:', this.videoSize);

        // å‰µå»ºå‹•æ…‹å°ºå¯¸çš„æ•ç²ç•«å¸ƒ
        this.captureCanvas = document.createElement('canvas');
        this.captureCanvas.width = this.videoSize[0];
        this.captureCanvas.height = this.videoSize[1];
        this.captureContext = this.captureCanvas.getContext('2d');

        // è¨­ç½®videoå…ƒç´ 
        const videoElement = document.createElement('video');
        videoElement.srcObject = stream;
        videoElement.play();

        return videoElement;
    }

    startStreaming(videoElement) {
        // å®šæœŸç™¼é€å½±åƒå¹€
        setInterval(() => {
            if (this.websocket && this.websocket.readyState === WebSocket.OPEN) {
                // ä½¿ç”¨å‹•æ…‹è§£æåº¦æ•ç²å½±åƒ
                this.captureContext.drawImage(videoElement, 0, 0, this.videoSize[0], this.videoSize[1]);
                const imageData = this.captureCanvas.toDataURL('image/jpeg', 0.8);

                const message = {
                    type: 'frame',
                    image: imageData,
                    timestamp: Date.now() / 1000
                };

                this.websocket.send(JSON.stringify(message));
            }
        }, 200); // 5 FPS
    }
}</div>
                </div>
            </div>
        </div>

        <!-- å‹•ä½œæª¢æ¸¬ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/action</span>
                    <div class="endpoint-description">å‹•ä½œæª¢æ¸¬ç‹€æ…‹å»£æ’­</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>å³æ™‚å»£æ’­å‹•ä½œæª¢æ¸¬éŠæˆ²çš„ç‹€æ…‹æ›´æ–°å’Œçµæœã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ å»£æ’­è¨Šæ¯æ ¼å¼</h3>

                    <div class="message-example">
                        <div class="message-type">éŠæˆ²é–‹å§‹ (Game Start)</div>
                        <pre>{
  "channel": "action",
  "type": "game_start",
  "difficulty": "medium",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">æª¢æ¸¬çµæœ (Detection Result)</div>
                        <pre>{
  "channel": "action",
  "type": "detection_result",
  "action": "jump",
  "confidence": 0.87,
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">ç‹€æ…‹æ›´æ–° (Status Update)</div>
                        <pre>{
  "channel": "action",
  "type": "status_update",
  "status": "running",
  "current_action": "raise_hand",
  "time_remaining": 45.2,
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‰‹å‹¢è­˜åˆ¥ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/gesture</span>
                    <div class="endpoint-description">æ‰‹å‹¢è­˜åˆ¥çµæœå»£æ’­</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>å³æ™‚å»£æ’­æ‰‹å‹¢è­˜åˆ¥çµæœå’Œç‹€æ…‹æ›´æ–°ã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ å»£æ’­è¨Šæ¯æ ¼å¼</h3>

                    <div class="message-example">
                        <div class="message-type">æ‰‹å‹¢æª¢æ¸¬ (Gesture Detected)</div>
                        <pre>{
  "channel": "gesture",
  "type": "gesture_detected",
  "gesture": "thumbs_up",
  "confidence": 0.92,
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">ç‹€æ…‹æ›´æ–° (Status Update)</div>
                        <pre>{
  "channel": "gesture",
  "type": "status_update",
  "status": "running",
  "uptime": 30,
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- çŸ³é ­å‰ªåˆ€å¸ƒæ•´åˆå¼ WebSocket (MediaPipe ç‰ˆæœ¬) -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/rps</span>
                    <div class="endpoint-description">â­ æ•´åˆå¼çŸ³é ­å‰ªåˆ€å¸ƒéŠæˆ² (MediaPipe å³æ™‚ä¸²æµ)</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p><strong>å–®ä¸€ WebSocket æ•´åˆæ‰€æœ‰åŠŸèƒ½</strong>ï¼šéŠæˆ²æ§åˆ¶ + å³æ™‚å½±åƒä¸²æµè¾¨è­˜ + ç‹€æ…‹å»£æ’­</p>
                    <p><strong>æŠ€è¡“æ¶æ§‹</strong>ï¼šMediaPipe å³æ™‚è¾¨è­˜ + å–®ä¸€ WebSocket é›™å‘é€šè¨Š + è‡ªå‹•æ‰‹å‹¢æäº¤</p>
                    <p><strong>å„ªå‹¢</strong>ï¼šé–‹ç™¼è€…åªéœ€é€£ç·šä¸€å€‹ç«¯é»ï¼Œç°¡åŒ–æ•´åˆæµç¨‹</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¤ å®¢æˆ¶ç«¯ç™¼é€è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³è¨Šæ¯ (Ping Message)</div>
                        <pre>{
  "type": "ping"
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šä¿æŒé€£æ¥æ´»èºçš„å¯é¸è¨Šæ¯</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŠæˆ²æ§åˆ¶ (Game Control)</div>
                        <pre>{
  "type": "game_control",
  "action": "start_game",
  "target_score": 1
}</pre>
                        <p><strong>action å€¼</strong>ï¼š<code>"start_game"</code>, <code>"stop_game"</code></p>
                        <p><strong>èªªæ˜</strong>ï¼šé–‹å§‹æˆ–åœæ­¢éŠæˆ²æœƒè©±</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å½±åƒå¹€ (Frame Message)</div>
                        <pre>{
  "type": "frame",
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šæŒçºŒç™¼é€æ”å½±æ©Ÿå¹€é€²è¡Œå³æ™‚æ‰‹å‹¢è¾¨è­˜ï¼Œå»ºè­° 5 FPS</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">æ‰‹å‹•æ‰‹å‹¢æäº¤ (Manual Gesture Submit)</div>
                        <pre>{
  "type": "submit_gesture",
  "gesture": "rock",
  "confidence": 0.85
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šæ‰‹å‹•æäº¤è¾¨è­˜çµæœï¼ˆå‚™ç”¨æ©Ÿåˆ¶ï¼‰</p>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ æœå‹™å™¨å›æ‡‰è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">æ§åˆ¶ç¢ºèª (Control Ack)</div>
                        <pre>{
  "type": "control_ack",
  "action": "start_game",
  "status": "started",
  "message": "éŠæˆ²å·²é–‹å§‹"
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šå°éŠæˆ²æ§åˆ¶æŒ‡ä»¤çš„å›æ‡‰</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">è¾¨è­˜çµæœ (Recognition Result)</div>
                        <pre>{
  "type": "recognition_result",
  "gesture": "rock",
  "confidence": 0.96,
  "timestamp": 1640995200.123,
  "is_valid": true
}</pre>
                        <p><strong>gesture å€¼</strong>ï¼š<code>"rock"</code>, <code>"paper"</code>, <code>"scissors"</code>, <code>"unknown"</code></p>
                        <p><strong>èªªæ˜</strong>ï¼šå³æ™‚æ‰‹å‹¢è¾¨è­˜çµæœ</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŠæˆ²ç‹€æ…‹ (Game State)</div>
                        <pre>{
  "type": "game_state",
  "stage": "waiting_player",
  "message": "ç­‰å¾…ç©å®¶å‡ºæ‹³",
  "data": {
    "round": 1,
    "scores": {"player": 0, "computer": 0}
  }
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šéŠæˆ²ç‹€æ…‹å»£æ’­è¨Šæ¯ï¼ˆç°¡åŒ–ä»‹é¢å·²ç§»é™¤æ–‡å­—æç¤ºï¼‰</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŒ¯èª¤è¨Šæ¯ (Error Message)</div>
                        <pre>{
  "type": "error",
  "message": "è¾¨è­˜å¤±æ•—",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³å›æ‡‰ (Pong Response)</div>
                        <pre>{
  "type": "pong"
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šå° ping è¨Šæ¯çš„å›æ‡‰</p>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ® éŠæˆ²ç‹€æ…‹å»£æ’­æ ¼å¼ï¼ˆ8 ç¨®éšæ®µï¼‰</h3>

                    <div class="message-example">
                        <div class="message-type">1ï¸âƒ£ éŠæˆ²é–‹å§‹ (game_started)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "game_started",
  "message": "éŠæˆ²é–‹å§‹ï¼ç›®æ¨™åˆ†æ•¸ï¼š3",
  "data": {
    "target_score": 3,
    "current_scores": {"player": 0, "computer": 0}
  },
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">2ï¸âƒ£ å›åˆé–‹å§‹ (round_started)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "round_started",
  "message": "ç¬¬ 1 å›åˆé–‹å§‹",
  "data": {
    "round": 1,
    "scores": {"player": 0, "computer": 0}
  },
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">3ï¸âƒ£ å€’æ•¸è¨ˆæ™‚ (countdown)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "countdown",
  "message": "å€’æ•¸: 3",
  "data": {"count": 3},
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>å‰ç«¯å»ºè­°</strong>ï¼šä½¿ç”¨å¤§å°ºå¯¸æ•¸å­—å‹•ç•«é¡¯ç¤ºå€’æ•¸ï¼Œåƒè€ƒ CSS å‹•ç•« <code>countdownPulse</code></p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">4ï¸âƒ£ ç­‰å¾…ç©å®¶å‡ºæ‹³ (waiting_player)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "waiting_player",
  "message": "ç­‰å¾…ç©å®¶å‡ºæ‹³...",
  "data": {
    "computer_gesture": "paper",
    "timeout": 10
  },
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šæ­¤æ™‚é›»è…¦å·²é¸æ“‡æ‰‹å‹¢ä½†ä¸é¡¯ç¤ºï¼Œç©å®¶éœ€åœ¨ 10 ç§’å…§é€é <code>/api/rps/submit</code> æäº¤åœ–ç‰‡</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">5ï¸âƒ£ å›åˆçµæœ (result)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "result",
  "message": "ä½ è´äº†ï¼",
  "data": {
    "result": "win",
    "gestures": {
      "player": "rock",
      "computer": "scissors"
    },
    "scores": {"player": 1, "computer": 0},
    "round": 1
  },
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>result å€¼</strong>ï¼š<code>"win"</code>, <code>"lose"</code>, <code>"draw"</code></p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">6ï¸âƒ£ éŠæˆ²çµæŸ (game_finished)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "game_finished",
  "message": "éŠæˆ²çµæŸï¼ç©å®¶ç²å‹ï¼",
  "data": {
    "winner": "player",
    "final_scores": {"player": 3, "computer": 1},
    "total_rounds": 4,
    "duration": 45.2
  },
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">7ï¸âƒ£ éŠæˆ²åœæ­¢ (game_stopped)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "game_stopped",
  "message": "éŠæˆ²å·²åœæ­¢",
  "data": {
    "reason": "user_request",
    "final_scores": {"player": 1, "computer": 1}
  },
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">8ï¸âƒ£ éŒ¯èª¤è¨Šæ¯ (error)</div>
                        <pre>{
  "channel": "rps_game",
  "stage": "error",
  "message": "è¶…æ™‚æœªå‡ºæ‹³ï¼Œæœ¬å›åˆåˆ¤å®šå¤±æ•—",
  "data": {
    "error_type": "timeout",
    "round": 2
  },
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ”— REST API é…åˆä½¿ç”¨</h3>
                    <table class="table">
                        <tr>
                            <th>ç«¯é»</th>
                            <th>æ–¹æ³•</th>
                            <th>èªªæ˜</th>
                        </tr>
                        <tr>
                            <td><code>/api/rps/start</code></td>
                            <td>POST</td>
                            <td>é–‹å§‹éŠæˆ²ï¼ˆåƒæ•¸ï¼štarget_scoreï¼‰</td>
                        </tr>
                        <tr>
                            <td><code>/api/rps/stop</code></td>
                            <td>POST</td>
                            <td>åœæ­¢éŠæˆ²</td>
                        </tr>
                        <tr>
                            <td><code>/api/rps/submit</code></td>
                            <td>POST</td>
                            <td>æäº¤ç©å®¶æ‰‹å‹¢åœ–ç‰‡ï¼ˆmultipart/form-dataï¼‰</td>
                        </tr>
                        <tr>
                            <td><code>/api/rps/status</code></td>
                            <td>GET</td>
                            <td>æŸ¥è©¢ç•¶å‰éŠæˆ²ç‹€æ…‹</td>
                        </tr>
                    </table>
                </div>

                <div class="section">
                    <h3>ğŸ¯ éŠæˆ²æµç¨‹åœ–</h3>
                    <div class="code-block">IDLE â†’ game_started â†’ round_started â†’ countdown (3â†’2â†’1)
     â†’ waiting_player â†’ [ç©å®¶ä¸Šå‚³åœ–ç‰‡] â†’ result
     â†’ [é‡è¤‡ round_started...] â†’ game_finished â†’ IDLE</div>
                </div>

                <div class="section">
                    <h3>ğŸ’» å®¢æˆ¶ç«¯å¯¦ä½œç¯„ä¾‹</h3>
                    <div class="code-block">class RPSGameClient {
    constructor() {
        this.ws = new WebSocket('ws://localhost:8896/ws/rps');
        this.setupWebSocket();
    }

    setupWebSocket() {
        this.ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.channel !== 'rps_game') return;

            switch(data.stage) {
                case 'countdown':
                    this.showCountdown(data.data.count);
                    break;
                case 'waiting_player':
                    this.enableGestureUpload();
                    break;
                case 'result':
                    this.showResult(data.data);
                    break;
            }
        };
    }

    async submitGesture(imageFile) {
        const formData = new FormData();
        formData.append('file', imageFile);

        const response = await fetch('/api/rps/submit', {
            method: 'POST',
            body: formData
        });

        return await response.json();
    }
}</div>
                </div>

                <div class="test-section">
                    <h4>ğŸ§ª äº’å‹•å¼æ¸¬è©¦å·¥å…·</h4>
                    <p>å®Œæ•´çš„æ¸¬è©¦ç•Œé¢ï¼ŒåŒ…å«é›™ WebSocket é€£ç·šç®¡ç†ã€éŠæˆ²æ§åˆ¶ã€å³æ™‚ä¸²æµå’Œäº’å‹•æ“ä½œã€‚</p>

                    <!-- WebSocket é€£ç·šç‹€æ…‹ -->
                    <div style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div class="input-group">
                            <label>ğŸ® æ•´åˆå¼ WebSocket (/ws/rps):</label>
                            <span id="rpsConnectionStatus" style="color: #999;">æœªé€£ç·š</span>
                        </div>
                    </div>

                    <!-- ä¸»è¦æ§åˆ¶æŒ‰éˆ• -->
                    <div class="test-controls" style="margin-bottom: 20px;">
                        <button class="btn btn-primary" id="rpsConnectBtn" onclick="rpsConnect()">ğŸ”Œ é€£ç·šæ•´åˆå¼ WS</button>
                        <button class="btn btn-success" id="rpsStartBtn" onclick="rpsStartGame()" disabled>â–¶ï¸ é–‹å§‹éŠæˆ²</button>
                        <button class="btn btn-danger" id="rpsStopBtn" onclick="rpsStopGame()" disabled>â¹ï¸ åœæ­¢éŠæˆ²</button>
                        <button class="btn btn-warning" id="rpsDisconnectBtn" onclick="rpsDisconnect()" disabled>ğŸ”Œ æ–·é–‹é€£ç·š</button>
                    </div>

                    <!-- æ”å½±æ©Ÿæ§åˆ¶ -->
                    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <h5 style="margin: 0 0 10px 0; color: #333;">ğŸ“· æ”å½±æ©Ÿæ§åˆ¶</h5>
                        <div class="test-controls">
                            <button class="btn btn-secondary" id="rpsCameraStartBtn" onclick="rpsStartCamera()">ğŸ“¹ å•Ÿå‹•æ”å½±æ©Ÿ</button>
                            <button class="btn btn-secondary" id="rpsCameraStopBtn" onclick="rpsStopCamera()" disabled>ğŸ“· åœæ­¢æ”å½±æ©Ÿ</button>
                            <button class="btn btn-secondary" id="rpsStreamStartBtn" onclick="rpsStartStreaming()" disabled>ğŸ¥ é–‹å§‹ä¸²æµ</button>
                            <button class="btn btn-secondary" id="rpsStreamStopBtn" onclick="rpsStopStreaming()" disabled>ğŸ¬ åœæ­¢ä¸²æµ</button>
                        </div>
                        <div id="rpsCameraPreview" style="margin-top: 10px; display: none;">
                            <video id="rpsTestVideo" style="max-width: 300px; max-height: 200px; border-radius: 8px; border: 2px solid #ddd;"></video>
                        </div>
                    </div>

                    <!-- éŠæˆ²è³‡è¨Šå¡ç‰‡ -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 20px;">
                        <div style="padding: 15px; background: #f5f7fa; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">å›åˆ</div>
                            <div id="rpsRound" style="font-size: 24px; font-weight: 700; color: #333;">0</div>
                        </div>
                        <div style="padding: 15px; background: #f5f7fa; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ç©å®¶</div>
                            <div id="rpsPlayerScore" style="font-size: 24px; font-weight: 700; color: #43e97b;">0</div>
                        </div>
                        <div style="padding: 15px; background: #f5f7fa; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">é›»è…¦</div>
                            <div id="rpsComputerScore" style="font-size: 24px; font-weight: 700; color: #f5576c;">0</div>
                        </div>
                        <div style="padding: 15px; background: #f5f7fa; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ç›®æ¨™</div>
                            <div id="rpsTargetScore" style="font-size: 24px; font-weight: 700; color: #667eea;">3</div>
                        </div>
                    </div>

                    <!-- åœ–ç‰‡ä¸Šå‚³å€ -->
                    <div style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600;">ğŸ“¸ ä¸Šå‚³æ‰‹å‹¢åœ–ç‰‡</label>
                        <input type="file" id="rpsFileInput" accept="image/*" onchange="rpsHandleFileSelect(event)"
                               style="margin-bottom: 10px;">
                        <div id="rpsPreview" style="margin-top: 10px; display: none;">
                            <img id="rpsPreviewImage" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
                        </div>
                        <button class="btn btn-success" id="rpsSubmitBtn" onclick="rpsSubmitGesture()" disabled
                                style="margin-top: 10px;">æäº¤æ‰‹å‹¢</button>
                    </div>

                    <!-- å³æ™‚æ‰‹å‹¢è¾¨è­˜é¡¯ç¤º -->
                    <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;">
                        <h5 style="margin: 0 0 10px 0; color: white;">ğŸ¤– å³æ™‚æ‰‹å‹¢è¾¨è­˜</h5>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center;">
                            <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                                <div style="font-size: 12px; opacity: 0.8;">ç›®å‰æ‰‹å‹¢</div>
                                <div id="rpsCurrentGesture" style="font-size: 24px; font-weight: 700;">â“</div>
                            </div>
                            <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                                <div style="font-size: 12px; opacity: 0.8;">ä¿¡å¿ƒåº¦</div>
                                <div id="rpsCurrentConfidence" style="font-size: 24px; font-weight: 700;">0%</div>
                            </div>
                            <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                                <div style="font-size: 12px; opacity: 0.8;">ç‹€æ…‹</div>
                                <div id="rpsGestureStatus" style="font-size: 16px; font-weight: 700;">æœªè¾¨è­˜</div>
                            </div>
                        </div>
                    </div>

                    <!-- æ¸¬è©¦æ“ä½œå€ -->
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <h5 style="margin: 0 0 10px 0; color: #856404;">ğŸ§ª æ¸¬è©¦æ“ä½œ</h5>
                        <div class="test-controls">
                            <button class="btn btn-info" id="rpsTestGestureBtn" onclick="rpsTestGesture()" disabled>æ¸¬è©¦æ‰‹å‹¢è¾¨è­˜</button>
                            <button class="btn btn-secondary" id="rpsSimulateGestureBtn" onclick="rpsSimulateGesture()" disabled>æ¨¡æ“¬éš¨æ©Ÿæ‰‹å‹¢</button>
                            <button class="btn btn-warning" id="rpsResetStatsBtn" onclick="rpsResetStats()">é‡ç½®çµ±è¨ˆ</button>
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; color: #856404;">
                            ğŸ’¡ æç¤ºï¼šå•Ÿå‹•ä¸²æµå¾Œï¼Œæ‰‹å‹¢è¾¨è­˜çµæœæœƒå³æ™‚é¡¯ç¤ºåœ¨ä¸Šæ–¹
                        </div>
                    </div>

                    <!-- å€’æ•¸é¡¯ç¤º -->
                    <div id="rpsCountdownDisplay" style="display: none; margin-top: 20px; text-align: center;">
                        <div style="font-size: 80px; font-weight: 900; color: #667eea; text-shadow: 0 0 20px rgba(102, 126, 234, 0.5); animation: pulse 0.5s ease-in-out;">
                            <span id="rpsCountdownNumber">3</span>
                        </div>
                    </div>

                    <!-- RPS è¨Šæ¯æ—¥èªŒ -->
                    <div class="log-area" id="rpsLogArea" style="margin-top: 15px; max-height: 300px; overflow-y: auto;">
                        <div style="color: #999;">ç­‰å¾…é€£ç·š...</div>
                    </div>
                    <button class="btn btn-success" onclick="rpsClearLog()" style="margin-top: 10px;">æ¸…ç©ºæ—¥èªŒ</button>
                </div>
            </div>
        </div>

        <!-- çŸ³é ­å‰ªåˆ€å¸ƒä¸²æµ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/rps/stream</span>
                    <div class="endpoint-description">ğŸ¥ çŸ³é ­å‰ªåˆ€å¸ƒå³æ™‚æ‰‹å‹¢ä¸²æµ (MediaPipe)</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>å³æ™‚è™•ç†æ”å½±æ©Ÿå½±åƒä¸²æµï¼Œä½¿ç”¨ MediaPipe é€²è¡Œæ‰‹å‹¢è¾¨è­˜ï¼Œæ”¯æ´å³æ™‚éŠæˆ²äº’å‹•ã€‚</p>
                    <p><strong>æŠ€è¡“æ¶æ§‹</strong>ï¼šWebSocket ä¸²æµ + MediaPipe å³æ™‚è¾¨è­˜ + ä¿¡å¿ƒåº¦éæ¿¾</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¤ å®¢æˆ¶ç«¯ç™¼é€è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">å½±åƒå¹€è¨Šæ¯ (Frame Message)</div>
                        <pre>{
  "type": "frame",
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šæŒçºŒç™¼é€æ”å½±æ©Ÿå¹€ï¼Œå»ºè­° 5 FPS é€²è¡Œå³æ™‚è¾¨è­˜</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³è¨Šæ¯ (Ping Message - å¯é¸)</div>
                        <pre>{
  "type": "ping",
  "timestamp": 1640995200.123
}</pre>
                        <p><strong>èªªæ˜</strong>ï¼šå¯é¸çš„å¿ƒè·³ä¿æ´»è¨Šæ¯</p>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ æœå‹™å™¨å›æ‡‰è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">è¾¨è­˜çµæœ (Result Message)</div>
                        <pre>{
  "type": "result",
  "gesture": "rock",
  "confidence": 0.96,
  "timestamp": 1640995200.123,
  "is_valid": true
}</pre>
                        <p><strong>gesture å€¼</strong>ï¼š<code>"rock"</code>, <code>"paper"</code>, <code>"scissors"</code>, <code>"unknown"</code></p>
                        <p><strong>is_valid</strong>ï¼šç•¶ gesture ä¸ç‚º "unknown" æ™‚ç‚º true</p>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŒ¯èª¤è¨Šæ¯ (Error Message)</div>
                        <pre>{
  "type": "error",
  "message": "å½±åƒè§£ç¢¼å¤±æ•—",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³å›æ‡‰ (Pong Response)</div>
                        <pre>"pong"</pre>
                        <p><strong>èªªæ˜</strong>ï¼šç´”æ–‡æœ¬å›æ‡‰ï¼Œä¸æ˜¯ JSON æ ¼å¼</p>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ”Œ é€£æ¥ç®¡ç†</h3>

                    <h4>é€£æ¥æ–¹å¼</h4>
                    <div class="code-block">// å»ºç«‹ä¸²æµé€£æ¥
const ws = new WebSocket('ws://localhost:8896/ws/rps/stream');

ws.onopen = () => {
    console.log('ä¸²æµé€£æ¥å·²å»ºç«‹ï¼Œå¯ä»¥é–‹å§‹ç™¼é€å½±åƒå¹€');
    // é–‹å§‹ç™¼é€æ”å½±æ©Ÿå¹€
    startCameraStreaming();
};

ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    if (data.type === 'result') {
        handleGestureResult(data.gesture, data.confidence);
    }
};
</div>

                    <h4>è‡ªå‹•é‡é€£</h4>
                    <div class="code-block">ws.onclose = () => {
    console.log('ä¸²æµé€£æ¥å·²é—œé–‰ï¼Œ5ç§’å¾Œé‡é€£...');
    setTimeout(() => {
        // é‡æ–°å»ºç«‹é€£æ¥
        setupStreamConnection();
    }, 5000);
};
</div>
                </div>

                <div class="section">
                    <h3>âš™ï¸ æ•ˆèƒ½åƒæ•¸</h3>
                    <table class="table">
                        <tr><th>åƒæ•¸</th><th>å»ºè­°å€¼</th><th>èªªæ˜</th></tr>
                        <tr><td>å¹€ç‡</td><td>5 FPS</td><td>å¹³è¡¡å³æ™‚æ€§å’Œä¼ºæœå™¨è² è¼‰</td></tr>
                        <tr><td>å½±åƒè§£æåº¦</td><td>640x480</td><td>é©ä¸­çš„è§£æåº¦ï¼Œæ¸›å°‘ç¶²è·¯å‚³è¼¸</td></tr>
                        <tr><td>JPEG å“è³ª</td><td>0.7-0.8</td><td>å£“ç¸®å“è³ª vs æª”æ¡ˆå¤§å°å¹³è¡¡</td></tr>
                        <tr><td>ä¿¡å¿ƒåº¦é–¾å€¼</td><td>0.5-0.7</td><td>è¾¨è­˜çµæœçš„å¯é åº¦é–€æª»</td></tr>
                        <tr><td>ç¶²è·¯å»¶é²</td><td>< 200ms</td><td>ç¢ºä¿éŠæˆ²æµæš¢é«”é©—</td></tr>
                    </table>
                </div>

                <div class="section">
                    <h3>ğŸ® éŠæˆ²æ•´åˆ</h3>
                    <p>æ­¤ä¸²æµç«¯é»å°ˆç‚ºå³æ™‚éŠæˆ²è¨­è¨ˆï¼Œèˆ‡ <code>/ws/rps</code> éŠæˆ²æ§åˆ¶ç«¯é»é…åˆä½¿ç”¨ï¼š</p>
                    <div class="code-block">// éŠæˆ²æ•´åˆç¯„ä¾‹
class RPSRealtimeGame {
    constructor() {
        // éŠæˆ²æ§åˆ¶ WebSocket
        this.gameWs = new WebSocket('ws://localhost:8896/ws/rps');

        // æ‰‹å‹¢ä¸²æµ WebSocket
        this.streamWs = new WebSocket('ws://localhost:8896/ws/rps/stream');

        this.waitingForGesture = false;
        this.setupConnections();
    }

    setupConnections() {
        // éŠæˆ²æ§åˆ¶è¨Šæ¯è™•ç†
        this.gameWs.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.stage === 'waiting_player') {
                // é–‹å§‹ç­‰å¾…ç©å®¶æ‰‹å‹¢
                this.waitingForGesture = true;
                console.log('ç­‰å¾…ç©å®¶å‡ºæ‹³...');
            }
        };

        // ä¸²æµè¾¨è­˜çµæœè™•ç†
        this.streamWs.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'result' && this.waitingForGesture) {
                if (data.confidence > 0.7) {
                    // é«˜ä¿¡å¿ƒåº¦æ‰‹å‹¢ï¼Œè‡ªå‹•æäº¤
                    this.submitGesture(data.gesture);
                    this.waitingForGesture = false;
                }
            }
        };
    }

    async submitGesture(gesture) {
        // æäº¤è¾¨è­˜çµæœåˆ°éŠæˆ²æœå‹™
        const response = await fetch('/api/rps/submit', {
            method: 'POST',
            body: formDataWithGestureImage
        });
    }
}</div>
                </div>

                <div class="section">
                    <h3>ğŸ’» ä¸²æµå®¢æˆ¶ç«¯ç¯„ä¾‹</h3>
                    <div class="code-block">// JavaScript å³æ™‚æ‰‹å‹¢ä¸²æµç¯„ä¾‹
class RPSGestureStreamer {
    constructor() {
        this.websocket = null;
        this.cameraStream = null;
        this.captureInterval = null;
        this.isStreaming = false;
    }

    async startStreaming() {
        try {
            // 1. å»ºç«‹ WebSocket é€£æ¥
            this.websocket = new WebSocket('ws://localhost:8896/ws/rps/stream');

            // 2. è¨­å®šè¨Šæ¯è™•ç†
            this.websocket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                this.handleStreamResult(data);
            };

            // 3. ç­‰å¾…é€£æ¥å»ºç«‹
            await new Promise((resolve, reject) => {
                this.websocket.onopen = resolve;
                this.websocket.onerror = reject;
            });

            // 4. å•Ÿå‹•æ”å½±æ©Ÿ
            this.cameraStream = await navigator.mediaDevices.getUserMedia({
                video: { width: 640, height: 480 }
            });

            const videoElement = document.createElement('video');
            videoElement.srcObject = this.cameraStream;
            videoElement.play();

            // 5. é–‹å§‹ç™¼é€å½±åƒå¹€
            this.captureInterval = setInterval(() => {
                this.captureAndSendFrame(videoElement);
            }, 200); // 5 FPS

            this.isStreaming = true;
            console.log('ğŸ¥ æ‰‹å‹¢ä¸²æµå·²å•Ÿå‹•');

        } catch (error) {
            console.error('å•Ÿå‹•ä¸²æµå¤±æ•—:', error);
        }
    }

    captureAndSendFrame(videoElement) {
        if (!this.websocket || this.websocket.readyState !== WebSocket.OPEN) {
            return;
        }

        // å‰µå»ºç•«å¸ƒä¸¦æ•ç²å½±åƒ
        const canvas = document.createElement('canvas');
        canvas.width = 640;
        canvas.height = 480;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(videoElement, 0, 0, 640, 480);

        // è½‰æ›ç‚º base64
        const imageData = canvas.toDataURL('image/jpeg', 0.8);

        // ç™¼é€åˆ°ä¼ºæœå™¨
        this.websocket.send(JSON.stringify({
            type: 'frame',
            image: imageData,
            timestamp: Date.now() / 1000
        }));
    }

    handleStreamResult(data) {
        if (data.type === 'result') {
            console.log(`ğŸ‘ï¸ å³æ™‚è¾¨è­˜: ${data.gesture} (${(data.confidence * 100).toFixed(1)}%)`);

            // æ›´æ–° UI é¡¯ç¤º
            this.updateGestureDisplay(data.gesture, data.confidence);
        }
    }

    stopStreaming() {
        this.isStreaming = false;

        if (this.captureInterval) {
            clearInterval(this.captureInterval);
            this.captureInterval = null;
        }

        if (this.cameraStream) {
            this.cameraStream.getTracks().forEach(track => track.stop());
        }

        if (this.websocket) {
            this.websocket.close();
        }
    }
}</div>
                </div>
            </div>
        </div>

        <!-- AI ç¹ªç•« WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/drawing</span>
                    <div class="endpoint-description">AI ç¹ªç•«æœƒè©±ç‹€æ…‹</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>å³æ™‚å»£æ’­AIç¹ªç•«æœƒè©±çš„ç‹€æ…‹å’Œè­˜åˆ¥çµæœã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ å»£æ’­è¨Šæ¯æ ¼å¼</h3>

                    <div class="message-example">
                        <div class="message-type">ç¹ªç•«è­˜åˆ¥ (Drawing Recognition)</div>
                        <pre>{
  "channel": "drawing",
  "type": "recognition_result",
  "recognized_shape": "circle",
  "confidence": 0.88,
  "bounding_box": [100, 150, 300, 250],
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">æœƒè©±ç‹€æ…‹ (Session Status)</div>
                        <pre>{
  "channel": "drawing",
  "type": "session_status",
  "status": "active",
  "stroke_count": 45,
  "canvas_size": [800, 600],
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‰‹å‹¢ç¹ªç•« WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/drawing/gesture</span>
                    <div class="endpoint-description">å³æ™‚æ‰‹å‹¢ç¹ªç•«æ§åˆ¶</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>è™•ç†å³æ™‚æ‰‹å‹¢æ§åˆ¶çš„ç¹ªç•«åŠŸèƒ½ï¼Œæ”¯æ´ç©ºä¸­æ‰‹å‹¢ç¹ªç•«ã€é¡è‰²é¸æ“‡å’Œç•«å¸ƒæ¸…ç©ºã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¤ å®¢æˆ¶ç«¯ç™¼é€è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">å•Ÿå‹•æ‰‹å‹¢ç¹ªç•« (Start Gesture Drawing)</div>
                        <pre>{
  "type": "start_gesture_drawing",
  "mode": "gesture_control",
  "color": "blue",
  "canvas_size": [720, 1280],
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">æ”å½±æ©Ÿå¹€ (Camera Frame)</div>
                        <pre>{
  "type": "camera_frame",
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">åœæ­¢ç¹ªç•« (Stop Drawing)</div>
                        <pre>{
  "type": "stop_drawing",
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ æœå‹™å™¨å›æ‡‰è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">ç¹ªç•«é–‹å§‹ç¢ºèª (Drawing Started)</div>
                        <pre>{
  "type": "drawing_started",
  "session_id": "gesture_12345",
  "canvas_size": [720, 1280],
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">æ‰‹å‹¢ç‹€æ…‹æ›´æ–° (Gesture Status)</div>
                        <pre>{
  "type": "gesture_status",
  "current_gesture": "drawing",
  "fingers_up": [false, true, false, false, false],
  "drawing_position": [320, 240],
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">ç•«å¸ƒæ›´æ–° (Canvas Update)</div>
                        <pre>{
  "type": "canvas_update",
  "canvas_base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
  "stroke_count": 15,
  "current_color": "blue",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">AIè­˜åˆ¥çµæœ (AI Recognition)</div>
                        <pre>{
  "type": "recognition_result",
  "recognized_shape": "circle",
  "confidence": 0.87,
  "message": "æˆ‘çœ‹åˆ°ä¸€å€‹åœ“å½¢ï¼(éå¸¸ç¢ºå®š)",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŒ¯èª¤è¨Šæ¯ (Error Message)</div>
                        <pre>{
  "type": "error",
  "message": "MediaPipe åˆå§‹åŒ–å¤±æ•—",
  "error_code": "MEDIA_PIPE_ERROR",
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ¤ æ‰‹å‹¢èªªæ˜</h3>
                    <table class="table">
                        <tr>
                            <th>æ‰‹å‹¢</th>
                            <th>èªªæ˜</th>
                            <th>å°æ‡‰å‹•ä½œ</th>
                        </tr>
                        <tr>
                            <td><strong>ğŸ‘† é£ŸæŒ‡ä¼¸å‡º</strong></td>
                            <td>åƒ…é£ŸæŒ‡ä¼¸ç›´ï¼Œå…¶ä»–æ‰‹æŒ‡å½æ›²</td>
                            <td>ç¹ªç•«æ¨¡å¼ - ä½¿ç”¨é£ŸæŒ‡å°–ç«¯ç¹ªç•«</td>
                        </tr>
                        <tr>
                            <td><strong>âœŒï¸ é›™æŒ‡ä¼¸å‡º</strong></td>
                            <td>é£ŸæŒ‡å’Œä¸­æŒ‡ä¼¸ç›´</td>
                            <td>é¸æ“‡æ¨¡å¼ - æ©¡çš®æ“¦åŠŸèƒ½</td>
                        </tr>
                        <tr>
                            <td><strong>âœ‹ äº”æŒ‡å…¨é–‹</strong></td>
                            <td>æ‰€æœ‰æ‰‹æŒ‡å®Œå…¨ä¼¸ç›´</td>
                            <td>æ¸…ç©ºæ¨¡å¼ - æ¸…ç©ºæ•´å€‹ç•«å¸ƒ</td>
                        </tr>
                    </table>
                </div>

                <div class="section">
                    <h3>âš™ï¸ æ•ˆèƒ½åƒæ•¸</h3>
                    <table class="table">
                        <tr><th>åƒæ•¸</th><th>å»ºè­°å€¼</th><th>èªªæ˜</th></tr>
                        <tr><td>å¹€ç‡</td><td>20-30 FPS</td><td>å¹³è¡¡å³æ™‚æ€§å’Œè™•ç†æ•ˆèƒ½</td></tr>
                        <tr><td>å½±åƒè§£æåº¦</td><td>å‹•æ…‹é©æ‡‰</td><td>è‡ªå‹•é©æ‡‰æ”å½±æ©Ÿå¯¦éš›è§£æåº¦ (å¦‚ 1920x1080, 1280x720 ç­‰)</td></tr>
                        <tr><td>æ‰‹å‹¢ç©©å®šæ€§</td><td>3å¹€ç¢ºèª</td><td>é¿å…æŠ–å‹•èª¤è§¸</td></tr>
                        <tr><td>ç¶²è·¯å»¶é²</td><td>< 50ms</td><td>ç¢ºä¿å³æ™‚äº’å‹•é«”é©—</td></tr>
                    </table>
                </div>

                <div class="section">
                    <h3>ğŸ’» ä½¿ç”¨ç¯„ä¾‹</h3>
                    <div class="code-block">// JavaScript æ‰‹å‹¢ç¹ªç•«æ•´åˆç¯„ä¾‹
class GestureDrawingClient {
    constructor() {
        this.ws = null;
        this.canvas = document.getElementById('drawing-canvas');
        this.setupWebSocket();
        this.setupCamera();
    }

    setupWebSocket() {
        this.ws = new WebSocket('ws://localhost:8896/ws/drawing/gesture');

        this.ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            this.handleServerMessage(data);
        };
    }

    async startDrawing() {
        // å•Ÿå‹•æ”å½±æ©Ÿ
        const stream = await navigator.mediaDevices.getUserMedia({video: true});
        this.videoElement.srcObject = stream;

        // ç™¼é€å•Ÿå‹•è¨Šæ¯
        this.ws.send(JSON.stringify({
            type: 'start_gesture_drawing',
            mode: 'gesture_control',
            color: 'blue',
            canvas_size: [720, 1280],
            timestamp: Date.now() / 1000
        }));
    }

    handleServerMessage(data) {
        switch(data.type) {
            case 'canvas_update':
                this.updateCanvas(data.canvas_base64);
                break;
            case 'gesture_status':
                this.updateGestureHints(data.current_gesture);
                break;
            case 'recognition_result':
                this.showRecognitionResult(data);
                break;
        }
    }
}</div>
                </div>
            </div>
        </div>

        <!-- é—œé–‰ä»£ç¢¼åƒè€ƒ -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">REF</span>
                    <span class="endpoint-url">WebSocket é—œé–‰ä»£ç¢¼</span>
                    <div class="endpoint-description">æ¨™æº–é—œé–‰ä»£ç¢¼å®šç¾©</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <table class="table">
                    <tr>
                        <th>ä»£ç¢¼</th>
                        <th>åç¨±</th>
                        <th>èªªæ˜</th>
                        <th>è§¸ç™¼æ¢ä»¶</th>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">1000</span></td>
                        <td>CLOSE_NORMAL</td>
                        <td>æ­£å¸¸é—œé–‰</td>
                        <td>å‰ç«¯å‘¼å« close() æˆ–æ­£å¸¸çµæŸ</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-info">1001</span></td>
                        <td>CLOSE_GOING_AWAY</td>
                        <td>ç«¯é»é›¢é–‹</td>
                        <td>é é¢é‡æ–°è¼‰å…¥ã€å°èˆªé›¢é–‹</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-error">1006</span></td>
                        <td>CLOSE_ABNORMAL</td>
                        <td>ç•°å¸¸é—œé–‰</td>
                        <td>ç¶²è·¯ä¸­æ–·ã€ä¼ºæœå™¨å´©æ½°</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-error">1008</span></td>
                        <td>CLOSE_POLICY_VIOLATION</td>
                        <td>é•åæ”¿ç­–</td>
                        <td>è¨Šæ¯æ ¼å¼éŒ¯èª¤ã€ç„¡æ•ˆæ•¸æ“š</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-error">1011</span></td>
                        <td>CLOSE_SERVER_ERROR</td>
                        <td>ä¼ºæœå™¨éŒ¯èª¤</td>
                        <td>å…§éƒ¨è™•ç†éŒ¯èª¤</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
