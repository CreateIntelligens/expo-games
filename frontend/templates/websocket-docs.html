<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expo Games WebSocket API æ–‡æª”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 10px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .endpoint-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .endpoint-header {
            background: #f8f9fa;
            padding: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e9ecef;
        }

        .endpoint-header:hover {
            background: #e9ecef;
        }

        .endpoint-method {
            background: #6c757d;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .endpoint-url {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #495057;
        }

        .endpoint-description {
            color: #6c757d;
            margin-top: 5px;
        }

        .endpoint-content {
            display: none;
            padding: 20px;
        }

        .endpoint-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            color: #495057;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .message-example {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }

        .message-type {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected {
            background: #48bb78;
        }

        .status-disconnected {
            background: #f56565;
        }

        .status-connecting {
            background: #ed8936;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .test-section {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .log-area {
            background: #1a202c;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            padding: 10px;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .input-group {
            margin-bottom: 10px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .toggle-arrow {
            transition: transform 0.2s;
        }

        .toggle-arrow.active {
            transform: rotate(90deg);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .table th, .table td {
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            text-align: left;
        }

        .table th {
            background: #f7fafc;
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .badge-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .badge-info {
            background: #bee3f8;
            color: #2a4365;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .test-controls {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”Œ Expo Games WebSocket API</h1>
            <p>å³æ™‚é›™å‘é€šè¨Šå”è­°æ–‡æª”èˆ‡æ¸¬è©¦å·¥å…·</p>
        </div>

        <!-- é€£æ¥ç‹€æ…‹æŒ‡ç¤ºå™¨ -->
        <div class="endpoint-card">
            <div class="endpoint-header">
                <div>
                    <span class="status-indicator status-disconnected" id="connectionStatus"></span>
                    <strong>WebSocket é€£æ¥ç‹€æ…‹</strong>
                    <div class="endpoint-description">ç›®å‰é€£æ¥ç‹€æ…‹å’Œæ§åˆ¶</div>
                </div>
            </div>
            <div class="endpoint-content">
                <div class="test-section">
                    <h4>ğŸ”— é€£æ¥æ¸¬è©¦</h4>
                    <div class="input-group">
                        <label>WebSocket URL:</label>
                        <input type="text" id="wsUrl" value="" readonly>
                    </div>
                    <div class="test-controls">
                        <button class="btn btn-primary" id="connectBtn">é€£æ¥</button>
                        <button class="btn btn-danger" id="disconnectBtn">æ–·é–‹</button>
                        <button class="btn btn-success" id="clearLogBtn">æ¸…é™¤æ—¥èªŒ</button>
                    </div>
                    <div class="log-area" id="logArea">ç­‰å¾…é€£æ¥...\n</div>
                </div>
            </div>
        </div>

        <!-- æƒ…ç·’åˆ†æ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/emotion/stream</span>
                    <div class="endpoint-description">å³æ™‚æƒ…ç·’åˆ†æä¸²æµ</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>è™•ç†å³æ™‚æ”å½±æ©Ÿå½±åƒä¸²æµï¼Œé€²è¡Œæƒ…ç·’åˆ†æä¸¦è¿”å›çµæœã€‚æ”¯æ´å¿ƒè·³æ©Ÿåˆ¶å’Œè‡ªå‹•é‡é€£ã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¤ å®¢æˆ¶ç«¯ç™¼é€è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">å½±åƒå¹€è¨Šæ¯ (Frame Message)</div>
                        <pre>{
  "type": "frame",
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³è¨Šæ¯ (Ping Message)</div>
                        <pre>{
  "type": "ping"
}</pre>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ æœå‹™å™¨å›æ‡‰è¨Šæ¯</h3>

                    <div class="message-example">
                        <div class="message-type">åˆ†æçµæœ (Result Message)</div>
                        <pre>{
  "type": "result",
  "emotion_zh": "é–‹å¿ƒ",
  "emotion_en": "happy",
  "emoji": "ğŸ˜Š",
  "confidence": 0.95,
  "timestamp": 1640995200.123,
  "frame_time": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŒ¯èª¤è¨Šæ¯ (Error Message)</div>
                        <pre>{
  "type": "error",
  "message": "å½±åƒåˆ†æéŒ¯èª¤: ç„¡æ³•æª¢æ¸¬åˆ°äººè‡‰",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">å¿ƒè·³å›æ‡‰ (Pong Response)</div>
                        <pre>"pong"</pre>
                    </div>
                </div>

                <div class="section">
                    <h3>âš™ï¸ æ•ˆèƒ½åƒæ•¸</h3>
                    <table class="table">
                        <tr><th>åƒæ•¸</th><th>å»ºè­°å€¼</th><th>èªªæ˜</th></tr>
                        <tr><td>å¹€ç‡</td><td>5-10 FPS</td><td>è¦–ç¶²è·¯å’Œè™•ç†èƒ½åŠ›è€Œå®š</td></tr>
                        <tr><td>å½±åƒè§£æåº¦</td><td>640x480</td><td>å¹³è¡¡å“è³ªå’Œæ•ˆèƒ½</td></tr>
                        <tr><td>å£“ç¸®å“è³ª</td><td>0.8 JPEG</td><td>å¹³è¡¡æª”æ¡ˆå¤§å°å’Œå“è³ª</td></tr>
                        <tr><td>ç¶²è·¯å»¶é²</td><td>< 200ms</td><td>å»ºè­°å»¶é²ä¸Šé™</td></tr>
                    </table>
                </div>

                <div class="section">
                    <h3>ğŸ’» ä½¿ç”¨ç¯„ä¾‹</h3>
                    <div class="code-block">// JavaScript ç™¼é€å½±åƒå¹€ç¯„ä¾‹
function sendFrame(videoElement) {
    const canvas = document.createElement('canvas');
    canvas.width = 640;
    canvas.height = 480;
    const ctx = canvas.getContext('2d');

    ctx.drawImage(videoElement, 0, 0, 640, 480);
    const imageData = canvas.toDataURL('image/jpeg', 0.8);

    const message = {
        type: 'frame',
        image: imageData,
        timestamp: Date.now() / 1000
    };

    websocket.send(JSON.stringify(message));
}</div>
                </div>
            </div>
        </div>

        <!-- å‹•ä½œæª¢æ¸¬ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/action</span>
                    <div class="endpoint-description">å‹•ä½œæª¢æ¸¬ç‹€æ…‹å»£æ’­</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>å³æ™‚å»£æ’­å‹•ä½œæª¢æ¸¬éŠæˆ²çš„ç‹€æ…‹æ›´æ–°å’Œçµæœã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ å»£æ’­è¨Šæ¯æ ¼å¼</h3>

                    <div class="message-example">
                        <div class="message-type">éŠæˆ²é–‹å§‹ (Game Start)</div>
                        <pre>{
  "channel": "action",
  "type": "game_start",
  "difficulty": "medium",
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">æª¢æ¸¬çµæœ (Detection Result)</div>
                        <pre>{
  "channel": "action",
  "type": "detection_result",
  "action": "jump",
  "confidence": 0.87,
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">ç‹€æ…‹æ›´æ–° (Status Update)</div>
                        <pre>{
  "channel": "action",
  "type": "status_update",
  "status": "running",
  "current_action": "raise_hand",
  "time_remaining": 45.2,
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ‰‹å‹¢è­˜åˆ¥ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/gesture</span>
                    <div class="endpoint-description">æ‰‹å‹¢è­˜åˆ¥çµæœå»£æ’­</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>å³æ™‚å»£æ’­æ‰‹å‹¢è­˜åˆ¥çµæœå’Œç‹€æ…‹æ›´æ–°ã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ å»£æ’­è¨Šæ¯æ ¼å¼</h3>

                    <div class="message-example">
                        <div class="message-type">æ‰‹å‹¢æª¢æ¸¬ (Gesture Detected)</div>
                        <pre>{
  "channel": "gesture",
  "type": "gesture_detected",
  "gesture": "thumbs_up",
  "confidence": 0.92,
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">ç‹€æ…‹æ›´æ–° (Status Update)</div>
                        <pre>{
  "channel": "gesture",
  "type": "status_update",
  "status": "running",
  "uptime": 30,
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- çŸ³é ­å‰ªåˆ€å¸ƒ WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/rps</span>
                    <div class="endpoint-description">çŸ³é ­å‰ªåˆ€å¸ƒéŠæˆ²ç‹€æ…‹</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>å³æ™‚å»£æ’­çŸ³é ­å‰ªåˆ€å¸ƒéŠæˆ²çš„ç‹€æ…‹å’Œçµæœã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ å»£æ’­è¨Šæ¯æ ¼å¼</h3>

                    <div class="message-example">
                        <div class="message-type">å›åˆçµæœ (Round Result)</div>
                        <pre>{
  "channel": "rps",
  "type": "round_result",
  "player_choice": "rock",
  "ai_choice": "paper",
  "result": "ai_win",
  "scores": {"player": 1, "ai": 2},
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">éŠæˆ²çµæŸ (Game End)</div>
                        <pre>{
  "channel": "rps",
  "type": "game_end",
  "final_scores": {"player": 2, "ai": 3},
  "winner": "ai",
  "duration": 120.5,
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI ç¹ªç•« WebSocket -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">WS</span>
                    <span class="endpoint-url">/ws/drawing</span>
                    <div class="endpoint-description">AI ç¹ªç•«æœƒè©±ç‹€æ…‹</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <div class="section">
                    <h3>ğŸ“‹ åŠŸèƒ½èªªæ˜</h3>
                    <p>å³æ™‚å»£æ’­AIç¹ªç•«æœƒè©±çš„ç‹€æ…‹å’Œè­˜åˆ¥çµæœã€‚</p>
                </div>

                <div class="section">
                    <h3>ğŸ“¥ å»£æ’­è¨Šæ¯æ ¼å¼</h3>

                    <div class="message-example">
                        <div class="message-type">ç¹ªç•«è­˜åˆ¥ (Drawing Recognition)</div>
                        <pre>{
  "channel": "drawing",
  "type": "recognition_result",
  "recognized_shape": "circle",
  "confidence": 0.88,
  "bounding_box": [100, 150, 300, 250],
  "timestamp": 1640995200.123
}</pre>
                    </div>

                    <div class="message-example">
                        <div class="message-type">æœƒè©±ç‹€æ…‹ (Session Status)</div>
                        <pre>{
  "channel": "drawing",
  "type": "session_status",
  "status": "active",
  "stroke_count": 45,
  "canvas_size": [800, 600],
  "timestamp": 1640995200.123
}</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- é—œé–‰ä»£ç¢¼åƒè€ƒ -->
        <div class="endpoint-card">
            <div class="endpoint-header" onclick="toggleEndpoint(this)">
                <div>
                    <span class="endpoint-method">REF</span>
                    <span class="endpoint-url">WebSocket é—œé–‰ä»£ç¢¼</span>
                    <div class="endpoint-description">æ¨™æº–é—œé–‰ä»£ç¢¼å®šç¾©</div>
                </div>
                <span class="toggle-arrow">â–¶</span>
            </div>
            <div class="endpoint-content">
                <table class="table">
                    <tr>
                        <th>ä»£ç¢¼</th>
                        <th>åç¨±</th>
                        <th>èªªæ˜</th>
                        <th>è§¸ç™¼æ¢ä»¶</th>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">1000</span></td>
                        <td>CLOSE_NORMAL</td>
                        <td>æ­£å¸¸é—œé–‰</td>
                        <td>å‰ç«¯å‘¼å« close() æˆ–æ­£å¸¸çµæŸ</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-info">1001</span></td>
                        <td>CLOSE_GOING_AWAY</td>
                        <td>ç«¯é»é›¢é–‹</td>
                        <td>é é¢é‡æ–°è¼‰å…¥ã€å°èˆªé›¢é–‹</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-error">1006</span></td>
                        <td>CLOSE_ABNORMAL</td>
                        <td>ç•°å¸¸é—œé–‰</td>
                        <td>ç¶²è·¯ä¸­æ–·ã€ä¼ºæœå™¨å´©æ½°</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-error">1008</span></td>
                        <td>CLOSE_POLICY_VIOLATION</td>
                        <td>é•åæ”¿ç­–</td>
                        <td>è¨Šæ¯æ ¼å¼éŒ¯èª¤ã€ç„¡æ•ˆæ•¸æ“š</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-error">1011</span></td>
                        <td>CLOSE_SERVER_ERROR</td>
                        <td>ä¼ºæœå™¨éŒ¯èª¤</td>
                        <td>å…§éƒ¨è™•ç†éŒ¯èª¤</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <script>
        let websocket = null;
        let reconnectInterval = null;

        // DOM å…ƒç´ 
        const connectionStatus = document.getElementById('connectionStatus');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const clearLogBtn = document.getElementById('clearLogBtn');
        const logArea = document.getElementById('logArea');
        const wsUrlInput = document.getElementById('wsUrl');

        // äº‹ä»¶ç›£è½å™¨
        connectBtn.addEventListener('click', connectWebSocket);
        disconnectBtn.addEventListener('click', disconnectWebSocket);
        clearLogBtn.addEventListener('click', clearLog);

        // åˆ‡æ›ç«¯é»å…§å®¹
        function toggleEndpoint(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('.toggle-arrow');

            content.classList.toggle('active');
            arrow.classList.toggle('active');
        }

        // é€£æ¥ WebSocket
        function connectWebSocket() {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                log('å·²ç¶“é€£æ¥äº†');
                return;
            }

            const url = wsUrlInput.value;
            log(`å˜—è©¦é€£æ¥: ${url}`);

            updateConnectionStatus('connecting');

            try {
                websocket = new WebSocket(url);

                websocket.onopen = function(event) {
                    log('âœ… WebSocket é€£æ¥æˆåŠŸ');
                    updateConnectionStatus('connected');
                    connectBtn.disabled = true;
                    disconnectBtn.disabled = false;
                };

                websocket.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        log(`ğŸ“¨ æ”¶åˆ°è¨Šæ¯: ${JSON.stringify(data, null, 2)}`);
                    } catch (e) {
                        log(`ğŸ“¨ æ”¶åˆ°æ–‡å­—è¨Šæ¯: ${event.data}`);
                    }
                };

                websocket.onclose = function(event) {
                    log(`ğŸ”Œ é€£æ¥é—œé–‰: ä»£ç¢¼=${event.code}, åŸå› =${event.reason}`);
                    updateConnectionStatus('disconnected');
                    connectBtn.disabled = false;
                    disconnectBtn.disabled = true;
                };

                websocket.onerror = function(error) {
                    log(`âŒ WebSocket éŒ¯èª¤: ${error}`);
                    updateConnectionStatus('disconnected');
                };

            } catch (error) {
                log(`âŒ é€£æ¥å¤±æ•—: ${error.message}`);
                updateConnectionStatus('disconnected');
            }
        }

        // æ–·é–‹ WebSocket
        function disconnectWebSocket() {
            if (websocket) {
                log('ğŸ”Œ æ­£åœ¨é—œé–‰é€£æ¥...');
                websocket.close(1000, 'ç”¨æˆ¶æ‰‹å‹•é—œé–‰');
                websocket = null;
            }
            connectBtn.disabled = false;
            disconnectBtn.disabled = true;
        }

        // æ›´æ–°é€£æ¥ç‹€æ…‹
        function updateConnectionStatus(status) {
            connectionStatus.className = `status-indicator status-${status}`;

            const statusText = {
                'connected': 'å·²é€£æ¥',
                'disconnected': 'æœªé€£æ¥',
                'connecting': 'é€£æ¥ä¸­'
            };

            connectionStatus.title = statusText[status] || status;
        }

        // æ—¥èªŒè¨˜éŒ„
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logArea.textContent += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        // æ¸…é™¤æ—¥èªŒ
        function clearLog() {
            logArea.textContent = '';
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è‡ªå‹•è¨­å®š WebSocket URL
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const host = window.location.host;
            wsUrlInput.value = `${protocol}//${host}/ws/emotion/stream`;

            updateConnectionStatus('disconnected');
            connectBtn.disabled = false;
            disconnectBtn.disabled = true;

            log('WebSocket API æ–‡æª”é é¢å·²è¼‰å…¥');
            log('é»æ“Š"é€£æ¥"æŒ‰éˆ•ä¾†æ¸¬è©¦ WebSocket é€£æ¥');
        });

        // é é¢é›¢é–‹æ™‚æ¸…ç†
        window.addEventListener('beforeunload', function() {
            if (websocket) {
                websocket.close();
            }
        });
    </script>
</body>
</html>
